---
title: 破解wetool历程
date: 2020-02-17
categories:
  - 
tags:
  - 
---

## 前言

> 女朋友在做销售的过程中，经常使用到wetool这款微信外挂工具。而随着其版本的升级，最实用的`群发`和`加好友`等一些功能都被吸收到了收费的pro版本中，免费版本被阉割得不那么实用了。好在，经过千辛万苦，终于找到一个破解的工具，及其对应版本的wetool和微信。不过问题是，这款破解工具只提供24小时的试用时间，试用期一过，在打开wetool就无法使用，卸载掉破解工具，wetool也将会自动更新。而这便是故事的开始...


## 破解试用期限

我首先想到的是去修改破解工具的试用期限，在尝试修改系统时间、监听注册表（有反监听机制，会导致破解工具不能打开）等方法，都没有效果之后，便想到了网络验证。通过断网的简单方法即得到了证实，的确是通过网络验证。

打开fiddler，问题是，如何将exe文件的请求代理到fiddler呢，浏览器可以使用switchyomega插件来完成(通过搜索以后成功解锁proxifier软件，通过它就可以实现请求的代理)。配置好代理，设置规则，启动破解工具，一气呵成，proxifier控制台和fiddler都在显示信息。在一阵摸索之后终于确定出主域名，于是在fiddler中打好断点。
```bash
bpu wetool.wxb.com
bpafter wetool.wxb.com
```
重新打开破解软件，看到了请求数据与相应结果，通过对试用成功前后的数据进行对比，找到了破解试用的关键字，在fillder中修改好数据。这时候，打开破解软件如期望那样显示试用成功的提示。接着打开目标工具，发现依然无法打开。也就是说破解工具的试用成功与否，跟软件能不能打开是两码事，软件打开的时候还会有其他验证

难道方向错了。。

## 抛弃破解工具

在发现软件打开的时候还会进行服务器验证之后，我便着手分析软件本身的请求。在有了前一步的经验基础上，也很快确定了软件自身的升级与update接口中的version字段有关，通过fiddler很容易就可以修改掉数据。于是，我将一份已经成功修改后的响应数据保存副本，并设置好自动响应。到这一步，只要开着fiddler，就可以试用工具了。但是，这种形式太过复杂，需要打开多个软件才能完成，而且本地还有需要保存一个文本，不能删掉。我还是想让女朋友在使用的时候能够只需要启动工具就行了

其实只要让软件的请求指向一个我能控制的服务器就好了，首先想到的就是修改HOSTS，因为DNS肯定是不能修改的了

打开HOSTS文件，里面赫然已经写着一条记录，很显然，这就是上面的破解软件写下的，也难怪为什么启动的时候需要管理员模式了。于是，很快就理清了破解软件的思路，于是可以很快的实现一个简单的服务。

## 思路

破解软件的思路：首先通过管理员模式启动程序，接着会发送一个带有本机唯一码作为参数的请求传递到服务器，服务器经过验证以后返回是否试用成功的信息，如果成功，就在HOSTS里添加一条`wetool.wxb.com`的记录，去指向自己的服务器。在打开工具时候，工具也会发送一系列请求，其中一个就是校验版本的请求，由于请求的ip被修改到了破解者的服务器，于是破解者就可以自己控制软件是否可以使用，这也是为什么仅仅试用成功还不行的原因。

我的思路：在女朋友的电脑上记录HOSTS记录到我的服务器，控制版本校验信息

## 实现

软件中请求包含HTTPS请求，于是顺便搞定了服务器证书的问题。用程序实现了基本版本时候，陆续解决了软件没有工具栏和崩溃的问题之后，总算完成

## 总结

1、熟悉了fiddler转包工具、proxifier代理工具的使用

2、证书的相关概念、及证书的生成

3、实现一个简单的https服务器

