---
title: 前端工程化-代码规范
date: '2021-05-09 18:00:08'
categories:
  - 前端
tags:
  - 工程化
lang: zh-cn
---

## 代码校验 - Eslint

`eslint`的作用是检查代码中不符合规则的地方，它跟很多 IDE 以及编辑器都能很好的结合，我们简单说一下在项目中的整合

### 安装

```bash
$ npm install eslint -D
$ yarn add eslint -D
```

### 初始化

```bash
$ npx eslint --init
```

<!-- more -->

会通过交互式的方式生成 eslint 的配置文件

### 使用

```bash
npx eslint --fix --ext .js,.jsx src/
```

或者配置到 package.json 文件中

eslint 官方还提供有很多其他的规则，具体的可以查看官网

推荐在 vscode 这种安装`Lintel`插件，提供可视化编辑 eslint 文件的功能

### 忽略文件

通过`.eslintignore`文件配置

### eslint-config-prettier

这个包是用来禁用 eslint 中可能会于 prettier 产生冲突的规则

```bash
$ npm install eslint-config-prettier -D
```

添加配置

```json
{
  "extends": ["some-other", "prettier"]
}
```

## 代码格式 - prettier

prettier 有一套自己的规则来格式化代码，也就是我们安装这个工具，就表示我们需要遵守它的规则

### 安装

```bash
$ npm install prettier
```

### 使用

在 package.json 中添加一个脚本

```json
{
  "scripts": {
    "prettier": "prettier --write src"
  }
}
```

执行 prettier 脚本，就可以自动格式化 src 目录下的代码，`--write`参数表示将格式化之后的内容写回到文件中，否则只是会输出到控制台

## prettier-eslint

这个配置工具整合了 prettier 和 eslint，帮我们手动去创建对应的配置文件

```bash
npm init prettier-eslint
npx create-prettier-eslint
yarn create prettier-eslint
```

除此之外，也建议在 vscode 中安装`prettier-eslint`插件，可以专门帮助我们解决 js 或 ts 文件的格式化问题，尤其在规则配置和格式化配置有冲突的时候非常有用

## prettier-eslint-cli

当我们在执行 prettier 的时候，是不能同时对代码进行校验的，这个工具的作用就是在 prettier 的同时对 js 文件不符合规则的地方进行修改

```
npx prettier-eslint --write src/**/*.js --
```

- 这个工具安装之后的可执行文件名就叫`prettier-eslint`
- 与`prettier`不同的是它不能作用于目录，只能匹配文件

## 结合 vscode

以上工具都是我们直接在项目当中，通过 npm 来安装使用，我们需要去结合相应的命令来达到使用上述工具的目的。

在 vscode 或其他编辑工具中，是可以实现在编辑文件之后，保存的时候实时的去完成上述工作，并且实时的显示代码的问题

首先我们需要安装几个插件，分别是上述工具对应的插件，最主要的就是`eslint`和`prettier`

eslint 插件会自动读取我们配置在项目中配置文件，基本不需要在编辑器上面配置 eslint 的相关规则

而我们要实现在保存文件的时候自动使用 prettier 来进行格式化，就需要设置 prettier 为默认的格式化工具，在 vscode 的 setting 页面搜索`formatter`，可以找到默认的配置，或者单独为某一类文件进行配置

最后就是开启`formatOnSave`，这样保存的时候，就能够实时的对文件进行格式化

一般而言，进过上述的设置 eslint 和 prettier 都能够很好的配合工偶，但有的时候，项目中修改了某些 lint 规则，导致在格式化的时候与 lint 规则冲突，而出现错误。这个时候我们就需要响应的调整格式化的配置

推荐使用`prettier-eslint`插件，将诸如`js`文件之类的默认 formatter 修改为

```json
"[javascript]": {
    "editor.defaultFormatter": "rvest.vs-code-prettier-eslint"
  }
```

这样就能使得在格式化的时候配合 eslint 的规则

如果是 vue 文件，推荐的格式器是`vetur`，或者`volar`。推荐安装`vue volar Extention Pack`集合包，比如使用 vrtur 进行格式，我们就可以针对 vetur 来调整不同的参数。具体参数设置可以参考其他文档

## 与 git 整合

我们的目标很简单，就是在提交代码的时候自动 lint 并对格式进行修复

### husky

husky 提供 git 操作的各种钩子，常用的如`pre-commit`

[继续阅读](../node/husky)

### lins-staged

lint-staged 的作用是仅对暂存区的文件执行操作

```json
{
  "lint-staged": {
    "*.js": ["prettier-eslint --write", "git add"],
    "*.css": ["prettier --write", "git add"]
  }
}
```

这样在文件提交之间可以自动的执行 ling 和 prettier
