(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{350:function(t,e,a){t.exports=a.p+"assets/img/bucket.02cea7fa.png"},351:function(t,e,a){t.exports=a.p+"assets/img/upload.71b3be40.png"},352:function(t,e,a){t.exports=a.p+"assets/img/ssl.d233494c.png"},353:function(t,e,a){t.exports=a.p+"assets/img/transform.553d4293.png"},354:function(t,e,a){t.exports=a.p+"assets/img/urlrule.6df2c56d.png"},564:function(t,e,a){"use strict";a.r(e);var s=a(14),r=Object(s.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"准备工作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[t._v("#")]),t._v(" 准备工作")]),t._v(" "),e("p",[t._v("首先需要具有以下的一些账号")]),t._v(" "),e("ul",[e("li",[t._v("域名，交由 cloudflare 管理")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://dash.cloudflare.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("cloudflare"),e("OutboundLink")],1),t._v("账号")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://secure.backblaze.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("backblaze"),e("OutboundLink")],1),t._v("账号")])]),t._v(" "),e("h2",{attrs:{id:"创建-bucket"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建-bucket"}},[t._v("#")]),t._v(" 创建 bucket")]),t._v(" "),e("p",[t._v("前往"),e("a",{attrs:{href:"https://secure.backblaze.com/b2_buckets.htm",target:"_blank",rel:"noopener noreferrer"}},[t._v("bucket"),e("OutboundLink")],1),t._v("，点击 create a bucket 按钮，创建一个 bucket")]),t._v(" "),e("p",[e("img",{attrs:{src:a(350),alt:""}})]),t._v(" "),e("p",[t._v("然后点击 Upload/Download，随便上传一个文件到你的 bucket 中。上传完成以后就可以看到这个图片的具体信息")]),t._v(" "),e("p",[e("img",{attrs:{src:a(351),alt:""}})]),t._v(" "),e("p",[t._v("注意其中的"),e("code",[t._v("Friendly URL")]),t._v("，这个就是我们要用的链接。比如："),e("code",[t._v("https://f004.backblazeb2.com/file/metadaddy-public/smiley.png")])]),t._v(" "),e("p",[t._v("接下来我们就要利用 cloudflare 代理这个图片地址")]),t._v(" "),e("h2",{attrs:{id:"创建-dns"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建-dns"}},[t._v("#")]),t._v(" 创建 DNS")]),t._v(" "),e("p",[t._v("前往 Cloudflare 的"),e("a",{attrs:{href:"https://dash.cloudflare.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("dash"),e("OutboundLink")],1),t._v("页面，来到域名的 DNS 页面创建一条 CNAME 记录，解析值为"),e("code",[t._v("f004.backblazeb2.com")])]),t._v(" "),e("p",[t._v("比如："),e("code",[t._v("img.example.com")]),t._v(" CNAME 解析到"),e("code",[t._v("f004.backblazeb2.com")])]),t._v(" "),e("p",[t._v("默认情况下，可能会出现访问失败，我们需要打开域名的 https 完整支持。")]),t._v(" "),e("p",[e("img",{attrs:{src:a(352),alt:""}})]),t._v(" "),e("p",[t._v("现在我们就可以通过"),e("code",[t._v("https://img.example.com/file/metadaddy-public/smiley.png")]),t._v("来访问到刚才的图片了")]),t._v(" "),e("h2",{attrs:{id:"链接转换"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#链接转换"}},[t._v("#")]),t._v(" 链接转换")]),t._v(" "),e("p",[t._v("在 cloudflare 的页面转换中添加一条重写 URL 规则，")]),t._v(" "),e("p",[e("img",{attrs:{src:a(353),alt:""}})]),t._v(" "),e("p",[t._v("创建规则")]),t._v(" "),e("p",[e("img",{attrs:{src:a(354),alt:""}})]),t._v(" "),e("p",[e("strong",[t._v("字段名选择主机名，预算符选择等于，值填入域名"),e("code",[t._v("img.example.com")]),t._v("。点击后面的 and")])]),t._v(" "),e("p",[t._v("再添加一条记录")]),t._v(" "),e("p",[e("strong",[t._v("字段名选择 URL 路径，运算符选择不包含，值填入要忽略的路径"),e("code",[t._v("/file/metadaddy-public")])])]),t._v(" "),e("p",[t._v("也可以点击编辑表达式按钮，输入")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('not starts_with(http.request.uri.path, "/file/metadaddy-public")\n或者\n(http.host eq "img.bianqu.cf" and not http.request.uri.path contains "/file/blog-images-public")\n')])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br")])]),e("p",[t._v("意思是如果请求的链接地址不是以"),e("code",[t._v("/file/metadaddy-public")]),t._v("，都将应用这条规则")]),t._v(" "),e("p",[t._v("然后重写地址，在 dynamic 中输入")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('concat("/file/metadaddy-public", http.request.uri.path)\n')])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("意思是将"),e("code",[t._v("/file/metadaddy-public")]),t._v("拼接到请求地址的前面")]),t._v(" "),e("p",[t._v("保存之后，就可以通过"),e("code",[t._v("https://img.example.com/smiley.png")]),t._v("来访问之前的图片了")])])}),[],!1,null,null,null);e.default=r.exports}}]);