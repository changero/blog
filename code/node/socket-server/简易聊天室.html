<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>简易聊天室 | 编程小兵</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="路漫漫其修远兮，吾将上下而求索">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/css/0.styles.f1c3a865.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/app.03a08a11.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/3.2b593545.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/13.d3406d66.js" as="script"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/10.3c93f85b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/100.7f414aae.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/101.2348dd18.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/102.8af3f469.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/103.8bb649de.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/104.d64fb347.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/105.ce0c9777.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/106.11da9663.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/107.6acbdc97.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/108.522fe21c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/109.a5bba632.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/11.ebed3f6f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/110.8f156d97.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/111.86c67076.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/112.5f49a31b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/113.b26c7462.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/114.696b6195.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/115.2af18a7e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/116.e95ec34b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/117.1dc05831.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/118.5dbd64d6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/119.49418e53.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/12.cd6b919a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/120.4fcffafe.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/121.e9e032e8.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/122.60e037d9.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/123.31fd7f53.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/124.254abdee.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/125.3cbe3455.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/126.60d98d65.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/127.cd76235a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/128.5cd53b9c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/129.74c81192.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/130.9b74fda3.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/131.1fab962e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/132.bb81e1a5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/133.94586e72.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/134.4ef040b8.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/135.d2982bab.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/136.2ba31a05.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/137.299dac49.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/138.30c41acb.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/139.eeb4e298.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/14.b7b3520d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/140.0f0f8a8d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/141.67b75bcc.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/142.e95b1380.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/143.81e92e93.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/144.96d2cd63.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/145.55a54f9b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/146.1e0e4953.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/147.2db0addc.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/148.dc37b068.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/149.b5354a4c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/15.adead415.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/150.5dcd2ab8.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/151.8357eebe.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/152.667a6f6a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/153.bc994aab.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/154.86570747.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/155.a2a0d4fd.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/156.61782a3b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/157.f59cfc6d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/158.0f57c646.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/159.8d0a1739.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/16.3544c358.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/160.48cbf202.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/161.eb7e545f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/162.e4ea72d1.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/163.e46cc598.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/164.59d1735d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/165.6c85b5c7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/166.5c1d7f30.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/167.bb9c87a5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/168.63c70fd6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/169.c082d58b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/17.d70afb94.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/170.691c62bb.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/171.e461bfff.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/172.cd727d86.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/173.6d2f51bf.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/174.e9a00beb.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/175.2023cb01.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/176.def07199.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/177.29f50ff6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/178.3dfef38b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/179.4a00d540.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/18.d6e9fd63.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/180.1bc4c639.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/181.ee4d4b4a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/182.e327e124.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/183.94d61f56.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/184.641beef6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/185.e89df33e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/186.33ca1636.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/187.27e9b734.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/188.a9718893.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/189.21aa469c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/19.9eb46e36.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/190.1102ac4e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/191.117892d3.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/192.5ee14712.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/193.e886b9a7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/194.bbcbf647.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/195.35930876.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/196.6b417531.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/197.eb7df7db.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/198.b95c627a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/199.a0fad090.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/2.948e236e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/20.06ec23d0.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/200.b9a3c912.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/201.ea81c5d7.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/202.bedf7c48.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/203.43c72de0.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/204.9c02e833.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/205.850f2d2d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/206.40e6135c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/207.bfe34217.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/208.a35aa765.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/209.f701b600.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/21.c7310922.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/210.f061322f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/211.e834fce2.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/22.a1625bb5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/23.6267640b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/24.1696d1e8.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/25.c4c34c07.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/26.54468745.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/27.22f30c94.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/28.fd7f6d68.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/29.376af419.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/30.259ca070.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/31.1f391c2e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/32.0e2aef91.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/33.bdd940e3.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/34.5e9ebf1a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/35.5f690222.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/36.6d527b07.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/37.92a94efa.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/38.ccb8d5c4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/39.6e88d2db.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/4.9fca145c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/40.b4f4bc7a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/41.024ab758.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/42.8aa4f572.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/43.2f721fd6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/44.fc4763d0.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/45.ce43007f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/46.cc56f930.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/47.7cff0305.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/48.4a64fde0.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/49.92b28a8d.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/5.afe584f1.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/50.bb382a13.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/51.1796af05.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/52.3a52b0c8.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/53.e4527fb1.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/54.23cd3cbd.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/55.0160435a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/56.0af7bbe2.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/57.b81f2a64.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/58.1a8c6276.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/59.11c44d96.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/6.9c204179.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/60.e78e9edc.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/61.9d75209e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/62.d9f26614.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/63.df8b3b78.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/64.9b2f3798.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/65.0422633e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/66.e9465fb5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/67.ef504779.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/68.0d2a9987.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/69.a18bc029.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/7.23f16619.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/70.7b55a276.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/71.37d3a981.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/72.a4bf3fe5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/73.9eec09bc.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/74.a3152b49.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/75.cc45d0ab.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/76.baaef140.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/77.ccb60a9a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/78.9890fb43.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/79.6355e3b0.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/8.08d1e0f6.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/80.163254c4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/81.8f67b062.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/82.e187c6c5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/83.567090ad.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/84.05f67456.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/85.a8363035.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/86.ad1f37ee.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/87.1b5b8331.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/88.a55c2a56.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/89.f76e674f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/9.013d5b21.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/90.379e76c0.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/91.67d52c2a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/92.d61adf71.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/93.f04d9e7f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/94.9c76f5da.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/95.9b8ace03.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/96.64e73c2e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/97.ee2b3ef1.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/98.e106b68f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/99.9f8cc9f5.js">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/css/0.styles.f1c3a865.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/hero.png" alt="编程小兵" class="logo"> <span class="site-name can-hide">编程小兵</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/share/" class="nav-link">
  分享
</a></div><div class="nav-item"><a href="/read/" class="nav-link">
  记录
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程" class="dropdown-title"><span class="title">编程</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程" class="mobile-dropdown-title"><span class="title">编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/code/basic/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/code/frontend/" class="nav-link">
  frontend
</a></li><li class="dropdown-item"><!----> <a href="/code/node/" class="nav-link router-link-active">
  node
</a></li><li class="dropdown-item"><!----> <a href="/code/tools/" class="nav-link">
  tools
</a></li><li class="dropdown-item"><!----> <a href="/code/rxjs/" class="nav-link">
  rxjs
</a></li><li class="dropdown-item"><!----> <a href="/code/git/" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/code/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/code/electron/" class="nav-link">
  electron
</a></li><li class="dropdown-item"><!----> <a href="/code/python/" class="nav-link">
  python
</a></li><li class="dropdown-item"><!----> <a href="/code/android/" class="nav-link">
  android
</a></li><li class="dropdown-item"><!----> <a href="/code/flutter/" class="nav-link">
  flutter
</a></li><li class="dropdown-item"><!----> <a href="/code/other/" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="/code/db/" class="nav-link">
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/code/network/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/code/linux/linux学习笔记.html" class="nav-link">
  linux
</a></li></ul></div></div><div class="nav-item"><a href="/navs/" class="nav-link">
  资源导航
</a></div><div class="nav-item"><a href="mailto://changero@126.com" class="nav-link external">
  联系我
  <!----></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/share/" class="nav-link">
  分享
</a></div><div class="nav-item"><a href="/read/" class="nav-link">
  记录
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程" class="dropdown-title"><span class="title">编程</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程" class="mobile-dropdown-title"><span class="title">编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/code/basic/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/code/frontend/" class="nav-link">
  frontend
</a></li><li class="dropdown-item"><!----> <a href="/code/node/" class="nav-link router-link-active">
  node
</a></li><li class="dropdown-item"><!----> <a href="/code/tools/" class="nav-link">
  tools
</a></li><li class="dropdown-item"><!----> <a href="/code/rxjs/" class="nav-link">
  rxjs
</a></li><li class="dropdown-item"><!----> <a href="/code/git/" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/code/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/code/electron/" class="nav-link">
  electron
</a></li><li class="dropdown-item"><!----> <a href="/code/python/" class="nav-link">
  python
</a></li><li class="dropdown-item"><!----> <a href="/code/android/" class="nav-link">
  android
</a></li><li class="dropdown-item"><!----> <a href="/code/flutter/" class="nav-link">
  flutter
</a></li><li class="dropdown-item"><!----> <a href="/code/other/" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="/code/db/" class="nav-link">
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/code/network/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/code/linux/linux学习笔记.html" class="nav-link">
  linux
</a></li></ul></div></div><div class="nav-item"><a href="/navs/" class="nav-link">
  资源导航
</a></div><div class="nav-item"><a href="mailto://changero@126.com" class="nav-link external">
  联系我
  <!----></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>配置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>文章</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>消息服务器开发</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/code/node/socket-server/" aria-current="page" class="sidebar-link">关于</a></li><li><a href="/code/node/socket-server/net.html" class="sidebar-link">消息服务器之net</a></li><li><a href="/code/node/socket-server/tcp双向通信.html" class="sidebar-link">tcp双向通信</a></li><li><a href="/code/node/socket-server/简易聊天室.html" class="active sidebar-link">简易聊天室</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/code/node/socket-server/简易聊天室.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/code/node/socket-server/简易聊天室.html#第一步-编写基础的逻辑" class="sidebar-link">第一步，编写基础的逻辑</a></li><li class="sidebar-sub-header"><a href="/code/node/socket-server/简易聊天室.html#repl" class="sidebar-link">repl</a></li><li class="sidebar-sub-header"><a href="/code/node/socket-server/简易聊天室.html#实现-client-的交互" class="sidebar-link">实现 client 的交互</a></li><li class="sidebar-sub-header"><a href="/code/node/socket-server/简易聊天室.html#server-端修改" class="sidebar-link">server 端修改</a></li><li class="sidebar-sub-header"><a href="/code/node/socket-server/简易聊天室.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/code/node/socket-server/socket.io入门.html" class="sidebar-link">socket.io入门</a></li><li><a href="/code/node/socket-server/socket.io自定义事件与认证.html" class="sidebar-link">socket.io自定义事件与认证</a></li><li><a href="/code/node/socket-server/socket命名空间.html" class="sidebar-link">socket命名空间</a></li><li><a href="/code/node/socket-server/消息推送.html" class="sidebar-link">消息推送</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>基于前面两篇的内容，我们现在已经能够实现一个极简易的控制台聊天室。它的功能非常简单，在控制台启动服务端之后，通过其他控制台，打开客户端，能够彼此收发消息。下面就开始相关逻辑的编写</p> <h2 id="第一步-编写基础的逻辑"><a href="#第一步-编写基础的逻辑" class="header-anchor">#</a> 第一步，编写基础的逻辑</h2> <p>与前面两节一样，我们先实现一个基本的连接事件</p> <details class="custom-block details"><summary>server 端</summary> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'net'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> socketSets <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 连接成功的时候保存socket</span>
  socketSets<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 客户端发送消息</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server started, listen on port 8000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></details> <p>这里选择 set 结构，是因为相比数组，能更好的对集合进行迭代和删除等操作</p> <details class="custom-block details"><summary>client 端</summary> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'net'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> socket <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务连接成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></details> <p>这样，就实现了一个基础的结构，每当有一个 client 连接进来的时候，都会在 server 端的控制台下打印一个 Hello。</p> <p>下面来继续填充逻辑，我们已经在每一个 client 连接进来的时候，将其收集起来了，因此要实现聊天室的功能，只需要在每一个客户端发送消息的时候，将其发送给其他所有的客户端就可以了。</p> <p>但现在，面临的问题是，如何在控制台自由的输入文本</p> <h2 id="repl"><a href="#repl" class="header-anchor">#</a> repl</h2> <p>nodejs 提供了<a href="http://nodejs.cn/api/repl.html#replstartoptions" target="_blank" rel="noopener noreferrer">repl<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>模块，可供在代码中调用终端的输入功能</p> <p>先来看看<code>repl</code>的基本使用</p> <details class="custom-block details"><summary>repl</summary> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> repl <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'repl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> instance <span class="token operator">=</span> repl<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">eval</span><span class="token punctuation">(</span><span class="token parameter">cmd<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></details> <p>其中<code>eval</code>就是我们处理输入的主要方法，默认值是 js 的 eval 方法。</p> <img src="data:image/png;base64,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" style="width:60%;"> <h2 id="实现-client-的交互"><a href="#实现-client-的交互" class="header-anchor">#</a> 实现 client 的交互</h2> <p>现在我们已经能够在控制台进行简单的交互了， 同时，为了使得每一条消息中都带有发送者的信息，因此，我们在创建 client 之前，需要先输入一个用户名。在这里我们就采用简单的一点的实现方式</p> <details class="custom-block details"><summary>输入用户名提示</summary> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> readline <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'readline'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> rl <span class="token operator">=</span> readline<span class="token punctuation">.</span><span class="token function">createInterface</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> process<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

rl<span class="token punctuation">.</span><span class="token function">question</span><span class="token punctuation">(</span><span class="token string">'请输入用户名：'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">answer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  rl<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>answer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></details> <p>在拿到用户名之后，就要创建连接了，我们将之前写的 socket 的处理封装到一个函数中，方便在拿到用户名之后直接调用。因此现在大致代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'net'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> readline <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'readline'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> client <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> userName <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">createSocket</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> socket <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务连接成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> socket<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> rl <span class="token operator">=</span> readline<span class="token punctuation">.</span><span class="token function">createInterface</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> process<span class="token punctuation">.</span>stdin<span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> process<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

rl<span class="token punctuation">.</span><span class="token function">question</span><span class="token punctuation">(</span><span class="token string">'请输入用户名：'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">answer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  rl<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  userName <span class="token operator">=</span> answer<span class="token punctuation">;</span>
  client <span class="token operator">=</span> <span class="token function">createSocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>可以看到 client 是作为全局变量的存在，主要是为了方便方法的调用，比如我们现在创建一个发送消息的方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  lient<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>
    <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      message<span class="token punctuation">,</span>
      username<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>现在我们就只需要调用 send 方法，就可以直接发送消息了，修改一下 connect 事件中的默认消息，将他改为由 send 发送</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务连接成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>效果如下：</p> <img src="data:image/png;base64,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" style="width:60%;"> <p>现在，就可以来实现发送消息的功能了，我们可以直接将上一步的 repl 功能封装到函数中，同样的，在 connect 事件发生的时候来调用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createRepl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  repl<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">prompt</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token function">eval</span><span class="token punctuation">(</span><span class="token parameter">cmd<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> message <span class="token operator">=</span> cmd<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务连接成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">createRepl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>接着要做的就是在 eval 函数中，得到输入值之后将他发送出去，这里我们就可以直接调用 send 方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">eval</span><span class="token punctuation">(</span><span class="token parameter">cmd<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> message <span class="token operator">=</span> cmd<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>效果如下：</p> <img src="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/img/client2.4c6dc495.png" style="width:60%;"> <h2 id="server-端修改"><a href="#server-端修改" class="header-anchor">#</a> server 端修改</h2> <p>现在 client 端已经可以发送消息了，多个 client 端都没关系，不过多个 client 端之间还无法通信，我们还要来实现一下 server 端，让他能够正常的去推送消息</p> <p>修改 server.js 中对 socket 的 data 事件为如下代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 客户端发送消息</span>
  <span class="token keyword">const</span> message <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server端收到消息'</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  socketSets<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">client</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>client <span class="token operator">!==</span> socket<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这样在客户端就能收到其他人发的消息啦。最后我们调整一下客户端收到的消息的格式</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> userName<span class="token punctuation">,</span> message <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>最终实现下来，整个程序还是有一些瑕疵，比如，如何使得 prompt 提示与其他人发送的消息能够更清晰的分开。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/code/node/socket-server/tcp双向通信.html" class="prev">
        tcp双向通信
      </a></span> <span class="next"><a href="/code/node/socket-server/socket.io入门.html">
        socket.io入门
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/app.03a08a11.js" defer></script><script src="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/3.2b593545.js" defer></script><script src="https://cdn.jsdelivr.net/gh/changero/blog@gh-pages/assets/js/13.d3406d66.js" defer></script>
  </body>
</html>
