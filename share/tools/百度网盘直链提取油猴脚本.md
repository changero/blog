---
title: 百度网盘直链提取油猴脚本
date: '2021-11-17 20:49:25'
categories:
  - 工具
tags:
  - 百度云
lang: zh-cn
---

[百度网盘提取链接下载（最新）- 软件小妹](https://greasyfork.org/zh-CN/scripts/418182)

[百度网盘提取链接下载](https://greasyfork.org/zh-CN/scripts/419252)

[百度网盘直链提取](https://greasyfork.org/zh-CN/scripts/403991)

[多合一直接下载助手 - 懒蛤蛤](https://greasyfork.org/zh-CN/scripts/370634)

<!-- more -->

[百度云去广告，快捷键倍速，免 VIP 解锁倍速、画质 - 涛之雨](https://greasyfork.org/zh-CN/scripts/422814-%E7%99%BE%E5%BA%A6%E4%BA%91%E5%8E%BB%E5%B9%BF%E5%91%8A-%E5%BF%AB%E6%8D%B7%E9%94%AE%E5%80%8D%E9%80%9F-%E5%85%8Dvip%E8%A7%A3%E9%94%81%E5%80%8D%E9%80%9F-%E7%94%BB%E8%B4%A8-%E5%85%A8%E7%BD%91%E7%8B%AC%E5%AE%B6)

::: details 脚本备份

```js
// ==UserScript==
// @icon         https://tva1.sinaimg.cn/large/008i3skNgy1gssioj5f67g30400403yc.gif
// @name         百度云去广告，快捷键倍速，免VIP解锁倍速、画质！全网独家！
// @namespace    baiduwangpan.taozhiyu.gitee.io
// @version      0.5.0
// @description  删除“复制这段内容后打开百度网盘手机App，操作更方便哦，来自百度会员超级无敌永久svip”，精简部主页广告、邀请，视频添加倍速按钮
// @author       涛之雨
// @require      https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.6/clipboard.min.js
// @require      https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.slim.min.js
// @match        *://pan.baidu.com/disk/*
// @match        *://pan.baidu.com/mbox/*
// @match        *://pan.baidu.com/play/*
// @match        *://yun.baidu.com/disk/*
// @match        *://yun.baidu.com/mbox/*
// @match        *://yun.baidu.com/play/*
// @match        *://pan.baidu.com/s/*
// @match        *://yun.baidu.com/s/*
// @match        *://pan.baidu.com/share/*
// @match        *://yun.baidu.com/share/*
// @grant	     GM_addStyle
// @grant	     unsafeWindow
// @grant        GM_getValue
// @grant        GM_setValue
// @home-url	 https://greasyfork.org/zh-CN/scripts/422814
// @license      GPL-3.0-only
// ==/UserScript==
/**********************************************\
 * 移除小尾巴部分修改自https://greasyfork.org/zh-CN/scripts/374100
 * 自定义密码部分修改自https://greasyfork.org/zh-CN/scripts/423146
 * 速率、画质等部分修改自videojs官方文档https://videojs.com/
 * V 0.5.0
 * 删除大量垃圾代码（找到更优解决办法！）虽然不知道是谁举报的脚本，我都代表大家感谢你，没有你我也不会去进行这么大规模修改的！
 * [相关举报链接](https://greasyfork.org/zh-CN/reports/12664) 因此，直接改了个大版本号。
 * 支持[新版界面](https://pan.baidu.com/disk/main?from=oldversion#/index?category=all)的广告拦截、自定义密码、默认分享时长改为无限制
 * 随手改了个更酷炫的黑金LOGO
 * 修改对于旧界面的支持性，更加完善
 * 修正对于提取码的匹配，使之更加精准
 * 添加定时读取提取码功能，有权限且未获取到正确的提取码时每秒重新获取
 * V 0.4.6（未公开）
 * 修复部分广告弹窗拦截
 * 优化部分代码
 * V 0.4.5
 * 修复“画中画”逻辑错误
 * 修复转存文件时界面显示错误
 * V 0.4.4
 * 大版本更新！！！
 * 全！网！独！家！支持百度云【免VIP】解锁倍速和画质！
 * （注：因服务器限制非会员速度，因此非会员会卡顿）
 * 需要看源码的朋友自行格式化。。。
 * 因为太大，把对齐的空格都删掉了（1.69M=>684K）
 * V 0.3.4
 * 悄咪咪修复部分（感觉就只有大萝卜一个）人百度网盘LOGO显示异常的问题（换了个图标）
 * 修复百度云更新造成的脚本无法倍速播放视频（目前仅有百度云VIP方可使用。。。）
 * 修复速率调节快捷键的一个bug（目前仅有百度云VIP方可使用。。。）
 * 添加“画中画”功能（需要浏览器支持），画中画模式快捷键将会失效，全屏自动退出画中画模式
 * V 0.3.3
 * 植入自定义密码功能（修改自【https://greasyfork.org/zh-CN/scripts/423146】，感谢提供思路，已获得授权）
 * 优化上述脚本
 * 修改默认分享时间为【永久】
 * 新增对于“内测提醒”弹窗的关闭支持
 * 倍速貌似失效了？算了，有空再看吧
 * V 0.3.2
 * 紧急修复误伤压缩包查看的bug
 * V 0.3.1
 * 新增对于【压缩包】、【CAD】和【思维导图】文件打开引导的屏蔽。
 * 新增在播放界面，新增快捷键控制播放速度：
 * -- (shift键无论是否按下，)按数字【0】即可恢复正常速度（原速快捷键）
 * -- 按下数字【1-9】可以分别调整速度为【1.25,1.5,1.75,2,2.4,2.7,4,6,8】（倍速快捷键）
 * -- 按下【shift】后再按下数字【1-9】可以分别调整速度为【0.1,0.15,0.2,0.25,0.3,0.5,0.6,0.8,0.9】（慢速快捷键）
 * -- (shift键无论是否按下，)每次按下【-】，当前速率减小0.1
 * -- (shift键无论是否按下，)每次按下【=】，当前速率增加0.1
 * V 0.3.0
 * 添加 + 自动读取、提交提取码的功能（第一次运行需要授权，有引导界面）
 * V 0.2.9
 * 修复 + 因为图省事，通用匹配导致某些界面被屏蔽的bug
 * V 0.2.8
 * 修复 + 视频倍速播放自动恢复的暗装（涛之雨全网独家的方法，如有借鉴请说明出处）
 * V 0.2.7
 * 调整 + 转存后的布局
 * 修复 + 删除部分遗漏广告
 * 新增 + 对于文件分享界面，的去广告支持
 * V 0.2.6
 * 新增 + 对于分享页的适配（去广告）
 * 新增 + 视频播放页添加倍速按钮（仿原生，贼强）
 * 添加 + 遵循协议 GPL-3.0-only
 * TODO : 默认永久分享（可自定义1-365天和永久）
 * TODO : 自定义分享密码（或公开链接，无密码）
 * TODO : 自定义限制分享次数链接
 * V 0.2.5
 * 新增 + 对于“在线视频”界面的支持
 * TODO : 加上倍速播放按钮
 * V 0.2.4
 * 新增 + 对于“分享”界面的支持
 * V 0.2.3
 * 删除 - 百度文库相关代码，迁移到新项目
 * V 0.2.1
 * 新增 + 百度文库大量垃圾、广告删除
 * TODO : 正在研究非VIP会员免【广告全屏阅读】
 * V 0.1.7
 * 修复 + “个人分享”界面“复制这段内容...”移除失败的bug
 * 新增 + 删除主界面的部分垃圾（可以自行对比）
 * 新增 + 关闭4秒内主动弹出的【设备管理】、【新功能测试】、【在线文档】、【在线解压】、等等。。。窗口
\************************************************/
(function() {
  'use strict';
  const w = unsafeWindow || window;
  const killWords = /内测|解压|体验|设备|专(属|享)|助手/;
  const changeFavicon = (link) => {
    let $favicon = document.querySelector('link[rel="shortcut icon"]');
    let $favicon1 = document.querySelector('link[rel="icon"]');
    $favicon ? ($favicon.href = link) : '';
    $favicon1 ? ($favicon1.href = link) : '';
    if (!($favicon || $favicon1)) {
      $favicon = document.createElement('link');
      $favicon.rel = 'icon';
      $favicon.href = link;
      document.head.appendChild($favicon);
    }
  };
  setTimeout(() => {
    //修改logo
    changeFavicon(
      'https://tva1.sinaimg.cn/large/008i3skNgy1gssioj5f67g30400403yc.gif'
    );
  }, 100);
  let myvideojs;
  var $ = $ || window.$ || w.$;
  const saveInfo = (a) => {
    GM_setValue('BaiduYunBeautify', JSON.stringify(a));
  };
  //兼容之前的版本，迁移数据并移除
  const getInfo = () => {
    return JSON.parse(localStorage.getItem('taozhiyuPanConfig'));
  };
  let oldinfo = getInfo() && !!getInfo().isfrist ? getInfo().isfrist : true;
  localStorage.clear('taozhiyuPanConfig');
  let info = GM_getValue('BaiduYunBeautify')
    ? JSON.parse(GM_getValue('BaiduYunBeautify'))
    : {};
  if (Object.keys(info).length < 3) {
    !info.SetKey && (info.SetKey = true);
    !info.sharePwd && (info.sharePwd = '');
    !info.isFristAutoEnterKey && (info.isFristAutoEnterKey = oldinfo);
    !info.isOldSDK && (info.isOldSDK = false);
    saveInfo(info);
  }
  GM_addStyle(`.phone-banner,
.button-badge,
.wp-share-file__link-ad,
.hx-right-bottom,
.title-wrap > .join-vip,
.title-wrap > .info,
.hx-bottom-wrapper,
.hx-recom-wrapper,
.app-btn,.hx-warp,
.relative-doc-ad-wrapper,
.qr-wrapper,
.cert-tip,
.side-doc-tool-wrapper,
.feedback-wrapper,
.popover-container,
.privilege-box,
.vip-pop-wrap,
.red-point,
.wp-side-options,
.module-header-wrapper > dl > dd[node-type='header-union'],
.yike-entrance,
.find-light-icon,
.newIcon,
.app-download,
.app-notice,
.icon-notice,
.icon-feedback,
.app-feedback,
.web-header-ad-item,
.wp-disk-header__right-item.company-cert,
.bz-doc-tool-dialog-fix,
.ex-wrapper,
.fixed-activity-bar,
.vip-card-wrap,
.btn-img-tips,
.rights-section,
a[title="举报"],
div[class^="ad-"],
.share-file__link-ad,
.vip-activity-content,
.video-title-right-open-mobile,
.tips{
display:none!important;
width:0!important;
overflow:hidden!important;
}

.after-trans-dialog .info-section {
padding: 99px 0!important;
}

#SetKey{
display: inline-block;
color: #fff;
font-size: 16px;
height: 42px;
line-height: 38px;
margin: 0 25px;
vertical-align: middle;
position: relative;
padding: 0 2px;
cursor: pointer;
}

#SetKey:hover {
opacity: .8;
}

`);
  let t = ' ',
    e = 'text',
    o = '去除小尾巴失败o(╥﹏╥)o',
    a = 'body',
    l = 'copy',
    y = true,
    f = (a) => {
      a.style.display = 'none';
      a.style.width = 0;
      a.style.overflow = 'hidden';
    };
  document.querySelector(a).addEventListener(l, function(a) {
    try {
      let l = a.target.value;
      (l = l
        .split(t)
        .filter((t, e) => {
          if (!!t.match(/手机App|复制这段/)) y = false;
          return y;
        })
        .join('')
        .replace('提取码', ' 提取码')),
        a.clipboardData.setData(e, l),
        a.preventDefault(),
        (y = true);
    } catch (a) {
      console.log(o);
    }
  });

  function autoInputCode(callback) {
    navigator.clipboard
      .readText()
      .then((a) => {
        callback(true, a);
      })
      .catch((v) => {
        callback(false, v);
      });
  }

  function checkmodule(argument) {
    var moduleJson = {
      '(': ')',
      '[': ']',
      '{': '}',
      "'": "'",
      '"': '"',
    };
    var testStr = argument;
    var tempSaveArray = testStr.replace(/\\./g, '').match(/['"\[\]\(\)\{\}]/g);
    if (tempSaveArray.length !== 0) {
      var isdan = false;
      var isshuang = false;
      for (var j = 0; j < tempSaveArray.length; j < 0 ? (j = 0) : j++) {
        if (
          j > 0 &&
          moduleJson[tempSaveArray[j - 1]] !== undefined &&
          moduleJson[tempSaveArray[j - 1]] == tempSaveArray[j]
        ) {
          tempSaveArray.splice(j - 1, 2);
          j -= 2;
          isdan = false;
          isshuang = false;
          continue;
        }
        if (isdan || isshuang) {
          var ischanged = false;
          if (isdan) {
            tempSaveArray.splice(j, 1);
            if (tempSaveArray[j] === "'") {
              isdan = false;
            }
            ischanged = true;
          }
          if (isshuang) {
            tempSaveArray.splice(j, 1);
            if (tempSaveArray[j] === '"') {
              isshuang = false;
            }
            ischanged = true;
          }
          if (ischanged) {
            j--;
            continue;
          }
        } else if (tempSaveArray[j] == '"') {
          isshuang = true;
        } else if (tempSaveArray[j] == "'") {
          isdan = true;
        }
      }
      if (tempSaveArray.length) {
        return false;
      } else {
        return true;
      }
    } else {
      return true;
    }
  }

  function retmatchtimes(i, endchar) {
    var txt = '([^' + endchar + ']*' + endchar + '){' + String(i) + '}';
    return txt;
  }

  function getFullFunctions(argument, exp, endchar = '\\}') {
    var matchingtimes = 0;
    try {
      var ret = '';
      while (matchingtimes <= 1000) {
        matchingtimes++;
        var tmp = argument.match(
          new RegExp(exp + retmatchtimes(matchingtimes, endchar), 'gm')
        );
        if (tmp === null) break;
        if (checkmodule(tmp[0])) {
          ret = tmp[0];
          break;
        }
      }
      return ret;
    } catch (e) {
      console.log(e);
      return '';
    }
  }
  if (location.href.indexOf('/share/my') < 0) {
    if (location.href.indexOf('disk/main') > 0) {
      w.taozhiyugetpass = (a) => {
        return info.sharePwd ? info.sharePwd : a;
      };
      w.webpackJsonp.tao = w.webpackJsonp.push;
      w.webpackJsonp.push = (a) => {
        for (var x in a[1]) {
          var e = a[1][x].toString();
          if (e.indexOf('createShareLink') >= 0) {
            var b = getFullFunctions(
                e,
                'createShareLink\\s*:\\s*function\\s*\\([^\\)]+\\)\\s*\\{'
              ),
              c = b.replace(/pwd\s*:\s*\w+/, (a) =>
                a.replace(/\w+$/, (a) => `window.taozhiyugetpass(${a})`)
              );
            var d = e.match(/function\s*\(([^,]+),([^,]+),([^)]+)\)/);
            e = e.replace(b, c); //植入自定义密码
            e = e.replace(/expiredTime\s*:\s*\d/, 'expiredTime:0'); //默认无限时长
            a[1][x] = new Function(
              d[1],
              d[2],
              d[3],
              e.substring(e.indexOf('{') + 1, e.length - 1)
            );
            break;
          }
        }
        w.webpackJsonp.tao(a);
      };
    } else {
      w.require.async(
        'function-widget-1:share/util/newShare/linkSetting.js',
        function(a) {
          a.a = a.makePrivatePassword;
          a.makePrivatePassword = function() {
            return info.sharePwd ? info.sharePwd : this.a();
          };
        }
      );
    }
    $(document).on('change', '.nd-input-share-pwd', function() {
      var value = this.value;
      if (value && !/[^\W_]{4}/.test(value)) {
        w.require &&
          w.require('system-core:system/uiService/tip/tip.js').show({
            mode: 'failure',
            msg: '提取码不合规范，只能是四位字母数字组合',
          });
      } else {
        info.sharePwd = value;
        saveInfo(info);
      }
    });
    ['.share-file__link-expired', '.wp-share-file__link-expired'].forEach(
      (x) => {
        $(document).on('DOMNodeInserted', x, () => {
          if ($('.nd-input-share-pwd').length == 0) {
            setTimeout(() => {
              var o = document.querySelector('#g-select-1');
              if (o !== null) {
                o.querySelector('.g-select-inner').click();
                var event = new CustomEvent('mousedown', { bubbles: 'true' });
                o.querySelector('#g-select-1 [data-value="0"]').dispatchEvent(
                  event
                );
              }
            }, 200);
            var html =
              '<div style="margin:10px;"></div><div class="share-file__link-expired-title wp-share-file__link-expired-title">自定义分享密码</div>';
            html +=
              '<div class="wp-share-file__link-pwd share-file__link-pwd"><div class="wp-share-file__link-expired-label inline-block-v-middle share-file__link-pwd-label">提取码</div>';
            html +=
              '<input type="text" class="nd-input-share-pwd" value="' +
              (info.sharePwd ? info.sharePwd : '') +
              '" placeholder="为空则随机四位" style="margin-left: 16px; width: 120px; height: 32px; line-height: 28px; border: 1px solid #D4D7DE; border-radius: 8px; text-align: left; padding-left: 12px"></div>';
            $(x).after(html);
          }
        });
      }
    );
  }
  if (location.href.indexOf('baidu.com/disk') >= 0) {
    let id1 = true,
      id2 = true,
      id3 = true;
    let id = setInterval(() => {
      //内测
      if (
        id1 &&
        document.querySelector('.wp-guide-dialog-content-title') &&
        document
          .querySelector('.wp-guide-dialog-content-title')
          .innerText.match(killWords)
      ) {
        document.querySelector('.wp-guide-dialog-close').click();
        id1 = false;
      }
      //企业用户专享「客户极速下载券」
      if (
        id2 &&
        document.querySelector('.nd-dialog-cert__header-title') &&
        document
          .querySelector('.nd-dialog-cert__header-title')
          .innerText.match(killWords)
      ) {
        document
          .querySelector('.nd-dialog-cert__header-title')
          .parentElement.parentElement.parentElement.parentElement.querySelector(
            '.u-dialog__headerbtn'
          )
          .click();
        id1 = false;
      }
      //设备
      if (
        id3 &&
        document.querySelector('.wp-aside-nav-bubble-title') &&
        document
          .querySelector('.wp-aside-nav-bubble-title')
          .innerText.match(killWords)
      ) {
        document.querySelector('.wp-aside-nav-bubble-close').click();
        id1 = false;
      }
      if (!id1 && !id2 && !id3) clearInterval(id);
      // document.querySelectorAll(".pdf2word-tip-close-btn").forEach(a=>{a.click()});
      // document.querySelectorAll(".dialog-close").forEach(a=>{a.click()});
      // document.querySelectorAll(".close-mask").forEach(a=>{a.click()});
      // document.querySelectorAll(".common-dialog-close").forEach(a=>{a.click()});
      // document.querySelectorAll(".wp-guide-dialog-close").forEach(a=>{a.click()});
      // document.querySelectorAll(".wp-tip-close-btn").forEach(a=>{a.click()});
      // document.querySelectorAll(".guide-dialog-close").forEach(a=>{a.click()});
      // document.querySelectorAll(".wp-disk-header__right-item").forEach((a)=>{if(a.href&&!!a.href.match(/buy|addnew/)){f(a);}});
    }, 10);
    setTimeout(() => {
      clearInterval(id);
    }, 20000);
    window.addEventListener('mouseup', (a) => {
      if (a.target.title !== '分享') {
        return;
      }
      let id2 = setInterval(() => {
        const x = document.querySelectorAll('.share-file__link-ad');
        if (!x) {
          return;
        }
        x.forEach((a) => {
          f(a);
        });
        setTimeout(() => {
          clearInterval(id2);
        }, 100);
      }, 10);
    });
  } else if (location.href.indexOf('play/video') >= 0) {
    var alreadytoast = false;
    let isVIP = w.require('base:widget/vip/vip.js').getVipValue() > 0;
    let killedVIP = false;
    w.require.async(
      'file-widget-1:videoPlay/HTML5Player/HTML5Player.js',
      (a) => {
        a.prototype.antiSpam = () => {};
      }
    );
    var Myasync = setInterval(() => {
      w.require.async('file-widget-1:videoPlay/context.js', function(a) {
        var tmpContext = a.getContext();
        if (!tmpContext) {
          return;
        }
        a.getContext().locals.set('is_svip', 1);
        a.getContext().locals.set('vip_level', '∞');
        if (tmpContext.useNewSDK !== undefined) {
          tmpContext.useNewSDK = !info.isOldSDK;
          a.setContext(tmpContext);
          clearInterval(Myasync);
        }
      });
    }, 100);
    const getmyvideo = (a) => {
      if (!myvideojs) return false;
      if (!myvideojs.players) {
        if (myvideojs.getPlayers && myvideojs.getPlayers()) {
          if (!!myvideojs.getPlayers()[a]) return myvideojs.getPlayers()[a];
          else return false;
        } else {
          try {
            if (!!myvideojs(a)) return myvideojs(a);
            else return false;
          } catch (e) {
            return false;
          }
        }
      } else {
        if (!!myvideojs.players[a]) return myvideojs.players[a];
        else return false;
      }
    };

    function loadscript(url) {
      var script = document.createElement('script');
      script.type = 'text/javacript';
      script.src = url;
      document.body.appendChild(script);
    }
    !isVIP &&
      w
        .require('system-core:system/uiService/tip/tip.js')
        .show({ mode: 'loading', msg: `等待广告加载结束` });
    let hasremoved = false,
      id = setInterval(() => {
        if ((myvideojs = myvideojs || w.videoPlayer)) {
          !isVIP &&
            !hasremoved &&
            (loadscript(
              'https://pannss.bdstatic.com/m-static/base/thirdParty/videojs/_nomd5_nomod/video_20210315.js'
            ),
            (hasremoved = true));
          if (!!getmyvideo('html5player')) {
            let vid =
              getmyvideo('html5player').tag ||
              getmyvideo('html5player').tech_.el_;
            clearInterval(id);
            if (document.pictureInPictureEnabled) {
              GM_addStyle(`
.video-functions-tips{
margin-top: -69px;
}`);
              vid.disablePictureInPicture = false;
              let li = document.createElement('li');
              li.id = 'ChangeSDK';
              li.innerHTML = `<svg t="1620441372115" style="width: 26px;height: 24px;margin-top: -7px;" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1317" width="48" height="48"><path d="M641.28 884.736V784.64a10.624 10.624 0 0 1 11.008-10.624h231.552a11.008 11.008 0 0 0 11.008-11.008v-36.864a11.008 11.008 0 0 0-11.008-11.008H472.96a11.008 11.008 0 0 0-7.424 18.816l156.992 157.184a11.008 11.008 0 0 0 18.816-6.4z m59.264-464.64v99.84a10.624 10.624 0 0 1-11.008 11.008H461.504a11.008 11.008 0 0 0-11.008 11.008v36.48a11.008 11.008 0 0 0 11.008 11.008h408.128a10.624 10.624 0 0 0 7.872-18.432l-156.992-156.992a11.008 11.008 0 0 0-20.032 6.4z" p-id="1318" fill="#ffffff"></path><path d="M817.152 128H206.528a78.464 78.464 0 0 0-78.464 78.464v602.752a78.464 78.464 0 0 0 78.464 78.464h229.568v-53.76H237.248a54.912 54.912 0 0 1-54.912-54.912V235.904a54.912 54.912 0 0 1 54.912-54.912h546.304a55.36 55.36 0 0 1 54.912 54.912v156.672a9.024 9.024 0 0 0 9.024 9.024h39.232a9.024 9.024 0 0 0 9.024-9.024V206.144a78.464 78.464 0 0 0-78.912-78.464z" p-id="1319" fill="#ffffff"></path></svg><span style="margin-top: -4px;">切至${
                info.isOldSDK ? '新' : '旧'
              }版</span>`;
              document.querySelector('ul.tips-ul.three-items').append(li);
              document.querySelector('#ChangeSDK').onclick = () => {
                info.isOldSDK = !info.isOldSDK;
                saveInfo(info);
                setTimeout(() => {
                  location.reload();
                }, 1000);
              };

              li = document.createElement('li');
              li.id = 'PInP_tao';
              li.innerHTML =
                '<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1168" style="width: 26px;height: 24px;margin-top: -7px;"><path d="M782 273H242v478h179v0.31a40.338 40.338 0 0 1 4.339-0.305L426 751c22.091 0 40 17.909 40 40s-17.909 40-40 40c-1.693 0-3.362-0.105-5-0.31v0.31H222c-33.137 0-60-26.863-60-60V253c0-33.137 26.863-60 60-60h580c33.137 0 60 26.863 60 60v176c0 22.091-17.909 40-40 40s-40-17.909-40-40V273z m20 263c33.137 0 60 26.863 60 60v175c0 33.137-26.863 60-60 60H588c-33.137 0-60-26.863-60-60V596c0-33.137 26.863-60 60-60h214z m-20 80H608v135h174V616z" p-id="1169" fill="#ffffff"></path></svg><span style="margin-top: -4px;">画中画</span>';
              document.querySelector('ul.tips-ul.three-items').append(li);
              document.querySelector('#PInP_tao').onclick = () => {
                var Observer;
                if (!document.pictureInPictureElement) {
                  Observer = new MutationObserver(function(
                    mutations,
                    instance
                  ) {
                    if (document.pictureInPictureElement) {
                      if (
                        getmyvideo('html5player').el_.classList.value.indexOf(
                          'vjs-fullscreen'
                        ) >= 0
                      ) {
                        // console.log("进入全屏，关闭画中画");
                        document
                          .exitPictureInPicture()
                          .catch((e) =>
                            console.warn(
                              '不会吧不会吧，开启没失败，取消反而失败了？',
                              e
                            )
                          );
                        Observer &&
                          (Observer.disconnect(), (Observer = undefined));
                      }
                    } else
                      Observer &&
                        (Observer.disconnect(), (Observer = undefined));
                  });

                  Observer.observe(getmyvideo('html5player').el_, {
                    attributes: true,
                    attributeFilter: ['class'],
                  });
                  vid
                    .requestPictureInPicture()
                    .catch((e) => console.warn('画中画开启失败：', e));
                } else {
                  document
                    .exitPictureInPicture()
                    .catch((e) =>
                      console.warn(
                        '不会吧不会吧，开启没失败，取消反而失败了？',
                        e
                      )
                    );
                  Observer && (Observer.disconnect(), (Observer = undefined));
                }
              };
            } else console.log('很遗憾，不支持画中画功能');

            if (info.isOldSDK) {
              var createEl = myvideojs.createEl,
                Menu = myvideojs.getComponent('Menu'),
                PlaybackRateMenuItem = myvideojs.getComponent(
                  'PlaybackRateMenuItem'
                );

              function inheritsLoose(subClass, superClass) {
                subClass.prototype = Object.create(superClass.prototype);
                subClass.prototype.constructor = subClass;
                subClass.__proto__ = superClass;
              }
              var PlaybackRateMenuButton = (function(_MenuButton) {
                inheritsLoose(PlaybackRateMenuButton, _MenuButton);

                function PlaybackRateMenuButton(player, options) {
                  var _this;

                  _this = _MenuButton.call(this, player, options) || this;

                  _this.updateVisibility();

                  _this.updateLabel();

                  _this.on(player, 'loadstart', _this.updateVisibility);

                  _this.on(player, 'ratechange', _this.updateLabel);

                  return _this;
                }

                var _proto = PlaybackRateMenuButton.prototype;

                _proto.createEl = function() {
                  var el = _MenuButton.prototype.createEl.call(this);

                  this.labelEl_ = createEl('div', {
                    className: 'vjs-playback-rate-value',
                    innerHTML: '1x',
                  });
                  el.appendChild(this.labelEl_);
                  return el;
                };

                _proto.dispose = function dispose() {
                  this.labelEl_ = null;

                  _MenuButton.prototype.dispose.call(this);
                };

                _proto.buildCSSClass = function buildCSSClass() {
                  return (
                    'vjs-playback-rate ' +
                    _MenuButton.prototype.buildCSSClass.call(this)
                  );
                };

                _proto.buildWrapperCSSClass = function buildWrapperCSSClass() {
                  return (
                    'vjs-playback-rate ' +
                    _MenuButton.prototype.buildWrapperCSSClass.call(this)
                  );
                };

                _proto.createMenu = function createMenu() {
                  var menu = new Menu(this.player());
                  var rates = this.playbackRates();

                  if (rates) {
                    for (var i = rates.length - 1; i >= 0; i--) {
                      menu.addChild(
                        new PlaybackRateMenuItem(this.player(), {
                          rate: rates[i],
                        })
                      );
                    }
                  }

                  return menu;
                };

                _proto.updateARIAAttributes = function updateARIAAttributes() {
                  this.el().setAttribute(
                    'aria-valuenow',
                    this.player().playbackRate()
                  );
                };

                _proto.handleClick = function handleClick(event) {
                  var currentRate = this.player().playbackRate();
                  var rates = this.playbackRates();

                  var newRate = rates[0];

                  for (var i = 0; i < rates.length; i++) {
                    if (rates[i] > currentRate) {
                      newRate = rates[i];
                      break;
                    }
                  }

                  this.player().playbackRate(newRate);
                };

                _proto.playbackRates = function playbackRates() {
                  return isVIP
                    ? [0.5, 0.75, 1, 1.5, 2, 2.7, 4]
                    : [0.5, 0.75, 1, 1.5, 2, 3];
                };

                _proto.playbackRateSupported = function playbackRateSupported() {
                  return (
                    this.player().tech_ &&
                    this.player().tech_.featuresPlaybackRate &&
                    this.playbackRates() &&
                    this.playbackRates().length > 0
                  );
                };

                _proto.updateVisibility = function updateVisibility(event) {
                  if (this.playbackRateSupported()) {
                    this.removeClass('vjs-hidden');
                  } else {
                    this.addClass('vjs-hidden');
                  }
                };

                _proto.updateLabel = function updateLabel(event) {
                  if (this.playbackRateSupported()) {
                    this.labelEl_.innerHTML =
                      'X' + this.player().playbackRate();
                  }
                };

                return PlaybackRateMenuButton;
              })(myvideojs.getComponent('MenuButton'));

              PlaybackRateMenuButton.prototype.controlText_ = isVIP
                ? '只是为了添加快捷键才替换的官方按钮'
                : '播放速率，\n涛之雨独家解锁VIP\n非VIP服务器限速，因此最大速率为3倍，\n购买百度云会员解锁更高倍率（可以通过快捷键调整尝试改高）';
              myvideojs.registerComponent('Myplayback', PlaybackRateMenuButton);

              getmyvideo('html5player').controlBar.removeChild(
                'playbackRateMenu'
              );
              if (!document.querySelector('.level-2,.level-1')) {
                //会员不用等待广告
                var aid = setInterval(() => {
                  if (
                    !getmyvideo('html5-werbung-player') ||
                    getmyvideo(
                      'html5-werbung-player'
                    ).el_.classList.value.indexOf('vjs-paused') >= 0
                  ) {
                    clearInterval(aid);
                    getmyvideo('html5player').controlBar.addChild(
                      'Myplayback',
                      {},
                      6
                    );
                  }
                }, 500);
              } else {
                GM_addStyle(`
.video-js .vjs-playback-rate{
	line-height: 2em;
font-size: 1.4em;
}
.vjs-workinghover .vjs-menu-button-popup:hover .vjs-menu{
	margin-bottom: 0.67em!important;
}`);
                getmyvideo('html5player').controlBar.addChild(
                  'Myplayback',
                  {},
                  6
                );
              }
            }
            var SetKey = document.createElement('sapn');
            SetKey.id = 'SetKey';
            SetKey.innerHTML =
              '快捷键已' + (info.SetKey === true ? '打开【√】' : '关闭【×】');
            SetKey.title = ` * 在播放界面，新增快捷键控制播放速度：
* （shift键无论是否按下，）按数字【0】即可恢复正常速度（原速快捷键）
* 按下数字【1-9】可以分别调整速度为【1.25,1.5,1.75,2,2.4,2.7,4,6,8】（倍速快捷键）
* 按下【shift】后再按下数字【1-9】可以分别调整速度为【0.1,0.15,0.2,0.25,0.3,0.5,0.6,0.8,0.9】（慢速快捷键）
* （shift键无论是否按下，）每次按下【-】，当前速率减小0.1
* （shift键无论是否按下，）每次按下【=】，当前速率增加0.1`;
            document
              .querySelector('dd[node-type="header-link"]')
              .append(SetKey);
            document.querySelector('#SetKey').onclick = (a) => {
              info.SetKey = !info.SetKey;
              a.target.innerHTML =
                '快捷键已' + (info.SetKey === true ? '打开【√】' : '关闭【×】');
              saveInfo(info);
            };
            var safeTime = false;
            document.onkeydown = function(e) {
              if (safeTime || !info.SetKey) return;
              safeTime = true;
              var k = e.keyCode || e.which || e.charCode;
              var p = getmyvideo('html5player').tech_.playbackRate();
              if (k === 48) p = 1;
              else if (k >= 49 && k <= 57)
                p = (!e.shiftKey
                  ? [1.25, 1.5, 1.75, 2, 2.4, 2.7, 4, 6, 8]
                  : [0.1, 0.15, 0.2, 0.25, 0.3, 0.5, 0.6, 0.8, 0.9])[k - 49];
              else if (k === 189) p -= 0.1;
              else if (k === 187) p += 0.1;
              getmyvideo('html5player').tech_.setPlaybackRate(
                parseFloat(p.toFixed(2))
              );
              setTimeout(() => {
                safeTime = false;
              }, 50);
            };
            getmyvideo('html5player').el_.onmouseenter = (a) => {
              let b = a.target;
              b.classList.remove('vjs-user-inactive');
              b.classList.add('vjs-user-active');
            };
            getmyvideo('html5player').el_.onmouseleave = (a) => {
              let b = a.target;
              b.classList.add('vjs-user-inactive');
              b.classList.remove('vjs-user-active');
            };
            w.require('system-core:system/uiService/tip/tip.js').show({
              vipType: 'svip',
              mode: 'success',
              msg: `涛之雨插件加载成功！敬请享受快捷键、画中画${
                isVIP ? '' : '、解锁倍速和高画质的快感！'
              }`,
            });
          }
        }
      }, 500);
  } else if (location.href.indexOf('share/init') >= 0) {
    if (info.isFristAutoEnterKey) {
      info.isFristAutoEnterKey = false;
      saveInfo(info);
      var m = document.createElement('div');
      m.style =
        'position: fixed;left: 0px;top: 0px;z-index: 50;background: rgb(0, 0, 0);opacity: 0.7;font-size: 30px;width: 100%;line-height: 2;display: flex;height: 100%;align-items: center;justify-content: center;flex-direction: column;color: wheat;flex-wrap: wrap;';
      m.id = 'taozhiyuMask';
      m.innerHTML =
        '<p>为了便于自动获取提取码</p><p>请在弹出框内点击允许</p><p>否则仅能手动输入/粘贴</p><br><p style="font-size: 14px;line-height: 1;">该信息仅在第一次打开时出现，点击屏幕消失</p>';
      document.querySelector('body').append(m);
      m.onclick = () => {
        m.remove();
      };
    }
    let autoCheck = setInterval(() => {
      navigator.permissions.query({ name: 'clipboard-read' }).then((result) => {
        if (result.state == 'granted' || result.state == 'prompt') {
          autoInputCode((c, a) => {
            if (c) {
              let b;
              if (/^\s*[a-z\d]{4}\s*$/.test(a)) b = a;
              else
                b = a.match(
                  /(?:密|提取|访问|訪問)[碼码]?\s*[:：]?\s*([a-z\d]{4})/
                );
              if (!!b) {
                b = typeof b === 'string' ? b : b[1];
                b = b.replace(/\s*/g, '');
                console.log('匹配到密码：', b);
                clearInterval(autoCheck);
                document.querySelector('#accessCode').value = b;
                document.querySelector('#submitBtn').click();
              } else {
                console.log('未匹配到常见密码');
              }
            } else {
              clearInterval(autoCheck);
              console.log(
                '不让我读取剪贴板你就自己粘贴去\n\n╭(╯^╰)╮哼\n\n如果是误操作请到“chrome://settings/content/clipboard”允许脚本读取剪贴板'
              );
            }
          });
        } else {
          clearInterval(autoCheck);
          console.log(
            '不让我读取剪贴板你就自己粘贴去\n\n╭(╯^╰)╮哼\n\n如果是误操作请到“chrome://settings/content/clipboard”允许脚本读取剪贴板'
          );
        }
      });
    }, 1000);
  }
})();
```

:::

[Github 镜像访问，加速下载](https://greasyfork.org/zh-CN/scripts/398278-github-%E9%95%9C%E5%83%8F%E8%AE%BF%E9%97%AE-%E5%8A%A0%E9%80%9F%E4%B8%8B%E8%BD%BD)

::: details 脚本备份

```js
// ==UserScript==
// @icon         https://github.githubassets.com/favicon.ico
// @name         Github 镜像访问，加速下载
// @namespace    https://github.com/jadezi/github-accelerator/
// @version      1.1.5
// @description  GitHub 镜像，github 加速
// @author       jadezi
// @license      GPL License
// @match        *://github.com/*
// @require      https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js
// @resource     mycss https://gitee.com/jadezi/github-accelerator-css/raw/master/index.css
// @grant        GM_addStyle
// @grant        GM_setClipboard
// @grant        GM_getResourceText
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_registerMenuCommand
// @grant        GM_openInTab
// ==/UserScript==

(function() {
  var clone = true;
  // var clone = false;
  var depth = true;
  // var depth = false;
  var hide = true;

  var location = window.location.href;
  var mirror_url1 = 'https://' + 'github.com.cnpmjs.org';
  var mirror_url2 = 'https://' + 'hub.fastgit.org';
  var mirror_url3 = 'https://' + 'github.wuyanzheshui.workers.dev';
  var download_url1 = 'https://download.fastgit.org';
  var str1 = '';

  if (clone) {
    str1 += 'git clone ';
    if (depth) {
      str1 += '--depth=1 ';
    }
  }

  var a = location.split('/');
  var b = a[5] === 'wiki' ? '.wiki' : '';
  var str2 = '/' + a[3] + '/' + a[4] + b + '.git';
  var clone_utl1 = str1 + mirror_url1 + str2;
  var clone_utl2 = str1 + mirror_url2 + str2;
  var str3 = window.location.pathname;
  var web_url1 = mirror_url1 + str3;
  var web_url2 = mirror_url2 + str3;
  var web_url3 = mirror_url3 + str3;
  // 镜像面板代码
  var info = `
    <div class="user-ment">
    <button class="btn btn-primary" type="button" id="mirror-btn">镜像网址</button>
    <div class="collapse multi-collapse" id="collapse">
    <div class="user-card user-card-body">
    <div class="user-alert user-alert-warning" role="alert">clone、depth命令的插入可手动编辑代码关闭</div>
    <div class="user-alert user-alert-danger" role="alert">镜像地址请不要登陆自己的账户，造成损失本人概不负责</div>
    <div class="user-input-group user-mb-3">
    <div class="user-input-group-prepend"><span class="user-input-group-text" id="inputGroup-sizing-default">快速克隆1:</span></div>
    <input id="clone_case_1" type="text" value="${clone_utl1}" data-autoselect="" class="user-form-control" aria-label="将此存储库克隆到 ${clone_utl1}" readonly aria-describedby="inputGroup-sizing-default">
    <div class="user-input-group-append">
    <button class="btn btn-outline-secondary" type="button" id="button-copy1"  data-container="body" data-toggle="popover" data-placement="bottom" data-content="复制成功">复制</button>
    </div>
    <button class="btn btn-outline-secondary" type="button" id="quickViewOne" href="${web_url1}" class="btn">快速浏览1</button>
    </div>
    <div class="user-input-group user-mb-3">
    <div class="user-input-group-prepend">
    <span class="user-input-group-text" id="inputGroup-sizing-default">快速克隆2:</span>
    </div>
    <input id="clone_case_2" type="text" value="${clone_utl2}" data-autoselect="" class="user-form-control" aria-label="将此存储库克隆到 ${clone_utl2}" readonly aria-describedby="inputGroup-sizing-default" >
    <div class="user-input-group-append">
    <button class="btn btn-outline-secondary" type="button" id="button-copy2"  data-container="body" data-toggle="popover" data-placement="bottom" data-content="复制成功">复制</button>
    </div>
    <button class="btn btn-outline-secondary" type="button" id="quickViewOther" class="btn">快速浏览2</button>
    </div>
    <div class="user-input-group user-mb-3">
    <div class="user-input-group-prepend">
    <span class="user-input-group-text" id="inputGroup-sizing-default">快速克隆3:</span>
    </div>
    <input type="text" data-autoselect="" class="user-form-control" aria-describedby="inputGroup-sizing-default" value="不支持clone,直接跳转--->" aria-label="" readonly="" >
    <button type="button" id="quickViewAnthor" class="btn">快速浏览3</button>
    </div>
    </div>
    </div>
    </div>`;

  $('.repository-content').prepend(info);
  $('.Box.Box--condensed').each(function() {
    // 修改源代码下载栏样式
    $(this)
      .find('.d-block.py-1.py-md-2.Box-body.px-2')
      .addClass('d-flex flex-justify-between');
    // 修改文件大小对齐方式
    $('.pl-2.color-text-secondary.flex-shrink-0').css({
      display: 'flex',
      'flex-grow': 1,
      'justify-content': 'flex-end',
    });
    $(this)
      .find('.d-flex.Box-body')
      .each(function() {
        var href = $(this)
          .children('a')
          .attr('href');
        var url1 = download_url1 + href;
        var url2 = mirror_url3 + href;
        var div1 = `<div class="user_download" style="display: flex;justify-content: flex-end;margin-left:9px"><div><a style="padding:4px;"  class="btn user-btn-link"  href="${url1}" rel="nofollow">快速下载1</a></div><div><a style="padding:4px"   class="btn user-btn-link" href="${url2}" rel="nofollow">快速下载2(推荐)</a></div></div>`;
        $(this).append(div1);
      });
  });
  // Fast download下载按钮
  $('.dropdown-menu .list-style-none li:last').each(function() {
    var url1 = mirror_url3 + '/' + a[3] + '/' + a[4] + '/archive/master.zip';
    var span1 = `<li class="Box-row Box-row--hover-gray p-0"><a class="d-flex flex-items-center text-gray-dark text-bold no-underline p-3" rel="nofollow" href="${url1}">Fast Download ZIP</a></li>`;
    $(this).after(span1);
  });
  // 复制按钮
  $('#button-copy1').on('click', function() {
    GM_setClipboard($('#clone_case_1').val());
    alert('复制成功');
  });
  $('#button-copy2').on('click', function() {
    GM_setClipboard($('#clone_case_2').val());
    alert('复制成功');
  });
  //页面跳转
  $('#quickViewOne').on('click', function() {
    window.location.href = web_url1;
  });
  $('#quickViewOther').on('click', function() {
    window.location.href = web_url2;
  });
  $('#quickViewAnthor').on('click', function() {
    window.location.href = web_url3;
  });
  // 隐藏面板
  $('#mirror-btn').on('click', function() {
    if (!hide) {
      $('#collapse').hide();
    } else {
      $('#collapse').show();
    }
    hide = !hide;
  });
  function mirrorBtnEvent() {
    if (!GM_getValue('mirror')) {
      $('#collapse').hide();
    } else {
      $('#collapse').show();
    }
  }
  function menuHideMirrorCollapse() {
    GM_setValue('mirror', !GM_getValue('mirror'));
    mirrorBtnEvent();
    console.log(GM_getValue('mirror'));
  }
  function init() {
    mirrorBtnEvent();
  }
  // 注册菜单
  GM_registerMenuCommand(
    `【🔔隐藏 & 显示镜像信息面板】`,
    menuHideMirrorCollapse
  );
  GM_registerMenuCommand(`【📢意见 & 反馈】`, function() {
    window.GM_openInTab(
      'https://github.com/jadezi/github-accelerator/issues/new',
      { active: true, insert: true, setParent: true }
    );
  });
  // 初始化面板
  init();
  GM_addStyle(GM_getResourceText('mycss'));
})();
```

:::

[Github 增强 - 高速下载](https://greasyfork.org/zh-CN/scripts/412245-github-%E5%A2%9E%E5%BC%BA-%E9%AB%98%E9%80%9F%E4%B8%8B%E8%BD%BD)

::: details 脚本备份

```js
// ==UserScript==
// @name         Github 增强 - 高速下载
// @version      1.7.1
// @author       X.I.U
// @description  高速下载 Git Clone/SSH、Release、Raw、Code(ZIP) 等文件、项目列表单文件快捷下载 (☁)
// @match        *://github.com/*
// @match        *://hub.fastgit.org/*
// @icon         https://i.loli.net/2021/03/30/ULV9XunaHesqGIR.png
// @grant        GM_registerMenuCommand
// @grant        GM_unregisterMenuCommand
// @grant        GM_openInTab
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_notification
// @license      GPL-3.0 License
// @run-at       document-end
// @namespace    https://greasyfork.org/scripts/412245
// @supportURL   https://github.com/XIU2/UserScript
// @homepageURL  https://github.com/XIU2/UserScript
// ==/UserScript==

(function() {
  'use strict';
  var backColor = '#ffffff',
    fontColor = '#888888';
  if (
    document.getElementsByTagName('html')[0].getAttribute('data-color-mode') ===
    'dark'
  ) {
    // 黑暗模式判断
    if (
      document
        .getElementsByTagName('html')[0]
        .getAttribute('data-dark-theme') === 'dark_dimmed'
    ) {
      backColor = '#272e37';
      fontColor = '#768390';
    } else {
      backColor = '#161a21';
      fontColor = '#97a0aa';
    }
  } else if (
    document.getElementsByTagName('html')[0].getAttribute('data-color-mode') ===
    'auto'
  ) {
    if (
      window.getComputedStyle(document.body).backgroundColor ===
      'rgb(34, 39, 46)'
    ) {
      backColor = '#272e37';
      fontColor = '#768390';
    } else if (
      window.getComputedStyle(document.body).backgroundColor ===
      'rgb(13, 17, 23)'
    ) {
      backColor = '#161a21';
      fontColor = '#97a0aa';
    }
  }
  const download_url = [
      ['https://pd.zwc365.com/seturl/https://github.com', '美国 1'],
      ['https://gh.xiu2.xyz/https://github.com', '美国 2'],
      ['https://gh.api.99988866.xyz/https://github.com', '美国 3'],
      ['https://github.rc1844.workers.dev', '美国 4'],
      ['https://download.fastgit.org', '日本'],
      ['https://ghproxy.com/https://github.com', '韩国'],
      ['https://ghproxy.fsou.cc/https://github.com', '香港'],
    ],
    clone_url = [
      ['https://hub.fastgit.org', '中国香港'],
      ['https://gitclone.com', '中国浙江'],
      ['https://github.com.cnpmjs.org', '新加坡'],
    ],
    clone_ssh_url = [
      ['git@git.zhlh6.cn', '中国北京'],
      ['git@hub.fastgit.org', '中国香港'],
    ],
    raw_url = [
      ['https://raw.githubusercontent.com', 'Github 原生', ''],
      [
        'https://cdn.jsdelivr.net',
        '中国国内',
        '注意：该加速源存在缓存机制（24小时），所以文件可能不是最新。&#10;注意：当前分支所有文件总文件大小超过 50MB 时，该加速源不可用。&#10;注意：当前分支名为版本号格式时（如 v1.2.3），该高速下载链接因格式限制不可用。',
      ],
      ['https://ghproxy.fsou.cc/https://github.com', '中国香港 1', ''],
      ['https://pd.zwc365.com/seturl/https://github.com', '中国香港 2'],
      [
        'https://raw.fastgit.org',
        '日本东京 1',
        '注意：单个文件太大时可能会提示超时（实时获取中），请重试。',
      ],
      [
        'https://cdn.staticaly.com',
        '日本东京 2',
        '注意：该加速是全球 Anycast CDN，国内一般分配到日本节点。',
      ],
    ],
    svg = [
      '<svg class="octicon octicon-file-zip mr-2" aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true"><path fill-rule="evenodd" d="M3.5 1.75a.25.25 0 01.25-.25h3a.75.75 0 000 1.5h.5a.75.75 0 000-1.5h2.086a.25.25 0 01.177.073l2.914 2.914a.25.25 0 01.073.177v8.586a.25.25 0 01-.25.25h-.5a.75.75 0 000 1.5h.5A1.75 1.75 0 0014 13.25V4.664c0-.464-.184-.909-.513-1.237L10.573.513A1.75 1.75 0 009.336 0H3.75A1.75 1.75 0 002 1.75v11.5c0 .649.353 1.214.874 1.515a.75.75 0 10.752-1.298.25.25 0 01-.126-.217V1.75zM8.75 3a.75.75 0 000 1.5h.5a.75.75 0 000-1.5h-.5zM6 5.25a.75.75 0 01.75-.75h.5a.75.75 0 010 1.5h-.5A.75.75 0 016 5.25zm2 1.5A.75.75 0 018.75 6h.5a.75.75 0 010 1.5h-.5A.75.75 0 018 6.75zm-1.25.75a.75.75 0 000 1.5h.5a.75.75 0 000-1.5h-.5zM8 9.75A.75.75 0 018.75 9h.5a.75.75 0 010 1.5h-.5A.75.75 0 018 9.75zm-.75.75a1.75 1.75 0 00-1.75 1.75v3c0 .414.336.75.75.75h2.5a.75.75 0 00.75-.75v-3a1.75 1.75 0 00-1.75-1.75h-.5zM7 12.25a.25.25 0 01.25-.25h.5a.25.25 0 01.25.25v2.25H7v-2.25z"></path></svg>',
      '<svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-paste js-clipboard-clippy-icon d-inline-block"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg><svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-check js-clipboard-check-icon color-text-success d-inline-block d-sm-none"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg>',
      '<svg class="octicon octicon-cloud-download" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path d="M9 12h2l-3 3-3-3h2V7h2v5zm3-8c0-.44-.91-3-4.5-3C5.08 1 3 2.92 3 5 1.02 5 0 6.52 0 8c0 1.53 1 3 3 3h3V9.7H3C1.38 9.7 1.3 8.28 1.3 8c0-.17.05-1.7 1.7-1.7h1.3V5c0-1.39 1.56-2.7 3.2-2.7 2.55 0 3.13 1.55 3.2 1.8v1.2H12c.81 0 2.7.22 2.7 2.2 0 2.09-2.25 2.2-2.7 2.2h-2V11h2c2.08 0 4-1.16 4-3.5C16 5.06 14.08 4 12 4z"></path></svg>',
    ],
    style = [
      'padding:0 6px;margin-right: -1px;border-radius: 2px;background-color: ' +
        backColor +
        ';border-color: rgba(27, 31, 35, 0.1);font-size: 11px;color: ' +
        fontColor +
        ';',
    ];
  var menu_raw_fast = GM_getValue('xiu2_menu_raw_fast'),
    menu_menu_raw_fast_ID,
    menu_feedBack_ID;
  if (menu_raw_fast == null) {
    menu_raw_fast = 1;
    GM_setValue('xiu2_menu_raw_fast', 1);
  }

  registerMenuCommand();
  // 注册脚本菜单
  function registerMenuCommand() {
    if (menu_feedBack_ID) {
      // 如果反馈菜单ID不是 null，则删除所有脚本菜单
      GM_unregisterMenuCommand(menu_menu_raw_fast_ID);
      GM_unregisterMenuCommand(menu_feedBack_ID);
      menu_raw_fast = GM_getValue('xiu2_menu_raw_fast');
    }
    if (menu_raw_fast > raw_url.length - 1) {
      // 避免在减少 raw 数组后，用户储存的数据大于数组而报错
      menu_raw_fast = 0;
    }
    menu_menu_raw_fast_ID = GM_registerMenuCommand(
      `${menu_num(menu_raw_fast)} [ ${
        raw_url[menu_raw_fast][1]
      } ] 加速源 (☁) - 点击切换`,
      menu_toggle_raw_fast
    );
    menu_feedBack_ID = GM_registerMenuCommand(
      '💬 反馈 & 建议 [Github]',
      function() {
        window.GM_openInTab('https://github.com/XIU2/UserScript', {
          active: true,
          insert: true,
          setParent: true,
        });
        window.GM_openInTab(
          'https://greasyfork.org/zh-CN/scripts/412245/feedback',
          { active: true, insert: true, setParent: true }
        );
      }
    );
  }

  // 切换加速源
  function menu_toggle_raw_fast() {
    if (menu_raw_fast >= raw_url.length - 1) {
      // 如果当前加速源位置大于等于加速源总数，则改为第一个加速源，反之递增下一个加速源
      menu_raw_fast = 0;
    } else {
      menu_raw_fast += 1;
    }
    GM_setValue('xiu2_menu_raw_fast', menu_raw_fast);
    delRawDownLink(); // 删除旧加速源
    addRawDownLink(); // 添加新加速源
    GM_notification({
      text: '已切换加速源为：' + raw_url[menu_raw_fast][1],
      timeout: 3000,
    }); // 提示消息
    registerMenuCommand(); // 重新注册脚本菜单
  }

  // 菜单数字图标
  function menu_num(num) {
    return ['0️⃣', '1️⃣', '2️⃣', '3️⃣', '4️⃣', '5️⃣', '6️⃣', '7️⃣', '8️⃣', '9️⃣', '🔟'][
      num
    ];
  }

  addRelease(); //                     Release 加速
  setTimeout(addDownloadZIP, 2000); // Download ZIP 加速
  setTimeout(addGitClone, 2000); //    Git Clone 加速
  setTimeout(addGitCloneSSH, 2000); // Git Clone SSH 加速
  addRawFile(); //                     Raw 加速
  setTimeout(addRawDownLink, 2000); // 添加 Raw 下载链接（☁），延迟 2 秒执行，避免被 pjax 刷掉

  document.addEventListener('pjax:success', function() {
    // pjax 事件发生后
    addRelease(); //                     Release 加速
    setTimeout(addDownloadZIP, 2000); // Download ZIP 加速
    setTimeout(addGitClone, 2000); //    Git Clone 加速
    setTimeout(addGitCloneSSH, 2000); // Git Clone SSH 加速
    addRawFile(); //                     Raw 加速
    setTimeout(addRawDownLink, 2000); // 添加 Raw 下载链接（☁），延迟 2 秒执行，避免被 pjax 刷掉
  });

  addLocationchange();
  window.addEventListener('locationchange', function() {
    addRawDownLink_(); // 在浏览器返回/前进时重新添加 Raw 下载链接（☁）事件
  });

  // Release
  function addRelease() {
    let html = document.getElementsByClassName('Box-footer');
    if (html.length == 0) return;
    let divDisplay = '';
    if (document.documentElement.clientWidth > 1000) {
      divDisplay = 'float: right;margin-top: -3px;margin-left: 8px;';
    } // 调整小屏幕时的样式
    Array.from(html).forEach(function(current) {
      current.querySelectorAll('li.Box-row > a').forEach(function(_this) {
        let href = _this.href.split(location.host),
          url = [],
          _html = `<div style="${divDisplay}">`;
        // 循环组合 URL 链接
        for (let i = 0; i < download_url.length; i++) {
          url[i] = download_url[i][0] + href[1];
          if (location.host === 'hub.fastgit.org')
            url[i] = url[i].replace('hub.fastgit.org', 'github.com');
          if (
            download_url[i][0] === 'https://download.fastgit.org' &&
            url[i].indexOf('/archive/') > -1
          )
            url[i] = url[i].replace(
              'https://download.fastgit.org',
              'https://archive.fastgit.org'
            );
        }
        // 循环生成 HTML 标签
        for (let i = 0; i < url.length; i++) {
          _html += `<a style="${style[0]}" class="btn" href="${url[i]}" rel="noreferrer noopener nofollow">${download_url[i][1]}</a>`;
        }
        _html += `</div>`;
        _this.insertAdjacentHTML('afterend', _html);
      });
    });
  }

  // Download ZIP
  function addDownloadZIP() {
    if (document.querySelector('.XIU2-DZ')) return;
    let html = document.querySelector(
      '.dropdown-menu.dropdown-menu-sw.p-0 ul li:last-child'
    );
    if (!html) return;
    let href = html.getElementsByTagName('a')[0].href,
      url = [],
      _html = ``;

    for (let i = 0; i < download_url.length; i++) {
      url[i] = download_url[i][0] + href.split(location.host)[1];
      if (location.host === 'hub.fastgit.org')
        url[i] = url[i].replace('hub.fastgit.org', 'github.com');
      if (
        download_url[i][0] === 'https://download.fastgit.org' &&
        url[i].indexOf('/archive/') > -1
      )
        url[i] = url[i].replace(
          'https://download.fastgit.org',
          'https://archive.fastgit.org'
        );
    }

    for (let i = 0; i < url.length; i++) {
      _html += `<li class="Box-row Box-row--hover-gray p-3 mt-0 XIU2-DZ"><a class="d-flex flex-items-center color-text-primary text-bold no-underline" rel="noreferrer nofollow" href="${url[i]}">${svg[0]}Download ZIP ${download_url[i][1]}</a></li>`;
    }
    html.insertAdjacentHTML('afterend', _html);
  }

  // Git Clone
  function addGitClone() {
    if (document.querySelector('.XIU2-GC')) return;
    let html = document.querySelector(
      '[role="tabpanel"]:nth-child(2) div.input-group'
    );
    if (!html) return;
    let href_split = html
        .getElementsByTagName('input')[0]
        .getAttribute('value')
        .split(location.host),
      url = [],
      _html = ``;

    for (let i = 0; i < clone_url.length; i++) {
      if (clone_url[i][0] === 'https://gitclone.com') {
        url[i] = clone_url[i][0] + '/github.com' + href_split[1];
      } else {
        url[i] = clone_url[i][0] + href_split[1];
      }
    }

    for (let i = 0; i < url.length; i++) {
      _html += `<div class="input-group XIU2-GC" style="margin-top: 4px;" title="加速源：${clone_url[i][1]} （点击可直接复制）"><input value="${url[i]}" aria-label="${url[i]}" type="text" class="form-control input-monospace input-sm color-bg-secondary" data-autoselect="" readonly=""><div class="input-group-button"><clipboard-copy value="${url[i]}" aria-label="Copy to clipboard" class="btn btn-sm js-clipboard-copy tooltipped-no-delay ClipboardButton" tabindex="0" role="button">${svg[1]}</clipboard-copy></div></div>`;
    }
    html.insertAdjacentHTML('afterend', _html);
  }

  // Git Clone SSH
  function addGitCloneSSH() {
    if (document.querySelector('.XIU2-GCS')) return;
    let html = document.querySelector(
      '[role="tabpanel"]:nth-child(3) div.input-group'
    );
    if (!html) return;
    let href_split = html
        .getElementsByTagName('input')[0]
        .getAttribute('value')
        .split(':'),
      url = [],
      _html = ``;

    if (href_split[0] != 'git@github.com') return;

    for (let i = 0; i < clone_ssh_url.length; i++) {
      url[i] = clone_ssh_url[i][0] + ':' + href_split[1];
    }

    for (let i = 0; i < url.length; i++) {
      _html += `<div class="input-group XIU2-GCS" style="margin-top: 4px;" title="加速源：${clone_ssh_url[i][1]} （点击可直接复制）"><input value="${url[i]}" aria-label="${url[i]}" type="text" class="form-control input-monospace input-sm color-bg-secondary" data-autoselect="" readonly=""><div class="input-group-button"><clipboard-copy value="${url[i]}" aria-label="Copy to clipboard" class="btn btn-sm js-clipboard-copy tooltipped-no-delay ClipboardButton" tabindex="0" role="button">${svg[1]}</clipboard-copy></div></div>`;
    }
    html.insertAdjacentHTML('afterend', _html);
  }

  // Raw
  function addRawFile() {
    if (document.querySelector('.XIU2-RF')) return;
    let html = document.getElementById('raw-url');
    if (!html) return;
    let href = location.href.replace(`https://${location.host}`, ''),
      href2 = href.replace('/blob/', '/'),
      href3 = document.getElementById('raw-url').getAttribute('href'),
      url = [
        raw_url[1][0] + '/gh' + href.replace('/blob/', '@'),
        raw_url[2][0] + href,
        raw_url[3][0] + href3,
        raw_url[4][0] + href2,
        raw_url[5][0] + '/gh' + href.replace('/blob/', '/'),
      ],
      _html = ``;
    for (let i = 0; i < url.length; i++) {
      _html += `<a href="${url[i]}" title="${
        raw_url[i + 1][2]
      }" target="_blank" role="button" rel="noreferrer noopener nofollow" class="btn btn-sm BtnGroup-item XIU2-RF">${
        raw_url[i + 1][1]
      }</a>`;
    }
    html.insertAdjacentHTML('afterend', _html);
  }

  // 添加 Raw 下载链接（☁）
  function addRawDownLink() {
    // 如果不是项目文件页面，就返回，如果网页有 Raw 下载链接（☁）就返回
    let files = document.querySelectorAll(
      'div.Box-row svg.octicon.octicon-file'
    );
    if (files.length === 0) return;
    if (location.pathname.indexOf('/tags') > -1) return;
    let files1 = document.querySelectorAll('a.fileDownLink');
    if (files1.length > 0) return;

    // 鼠标指向则显示
    var mouseOverHandler = function(evt) {
      let elem = evt.currentTarget,
        aElm_new = elem.querySelectorAll('.fileDownLink'),
        aElm_now = elem.querySelectorAll('svg.octicon.octicon-file');
      aElm_new.forEach((el) => {
        el.style.cssText = 'display: inline';
      });
      aElm_now.forEach((el) => {
        el.style.cssText = 'display: none';
      });
    };

    // 鼠标离开则隐藏
    var mouseOutHandler = function(evt) {
      let elem = evt.currentTarget,
        aElm_new = elem.querySelectorAll('.fileDownLink'),
        aElm_now = elem.querySelectorAll('svg.octicon.octicon-file');
      aElm_new.forEach((el) => {
        el.style.cssText = 'display: none';
      });
      aElm_now.forEach((el) => {
        el.style.cssText = 'display: inline';
      });
    };

    // 循环添加
    files.forEach(function(fileElm, i) {
      let trElm = fileElm.parentNode.parentNode,
        cntElm_a = trElm.querySelector(
          '.css-truncate.css-truncate-target.d-block.width-fit a'
        ),
        cntElm_svg = trElm.querySelector(
          '.mr-3.flex-shrink-0 svg.octicon.octicon-file'
        ),
        Name = cntElm_a.innerText,
        href = cntElm_a.attributes.href.nodeValue.replace(
          `https://${location.host}`,
          ''
        );
      let href2 = href.replace('/blob/', '/'),
        href3 = document.getElementById('raw-url').getAttribute('href'),
        url,
        url_name,
        url_tip = '';
      switch (menu_raw_fast) {
        case 0:
        case 4:
          url = raw_url[menu_raw_fast][0] + href2;
          break;
        case 2:
          url = raw_url[menu_raw_fast][0] + href;
          break;
        case 3:
          url = raw_url[menu_raw_fast][0] + href3;
          break;
        case 1:
          url = raw_url[menu_raw_fast][0] + '/gh' + href.replace('/blob/', '@');
          break;
        case 5:
          url = raw_url[menu_raw_fast][0] + '/gh' + href.replace('/blob/', '/');
          break;
        default:
          url = raw_url[menu_raw_fast][0] + '/' + raw_url[0][0] + href2;
      }
      url_name = raw_url[menu_raw_fast][1];
      url_tip = raw_url[menu_raw_fast][2];
      let _html = ` <a href="${url}" download="${Name}" target="_blank" rel="noreferrer noopener nofollow" class="fileDownLink" style="display: none;" title="「${url_name}」&#10;&#10;[Alt + 左键] 或 [右键 - 另存为...] 下载文件。&#10;注意：鼠标点击 [☁] 图标，而不是左侧的文件名！&#10;&#10;${url_tip}提示：点击浏览器右上角 Tampermonkey 扩展图标 - [ ${raw_url[menu_raw_fast][1]} ] 加速源 (☁) 即可切换。">${svg[2]}</a>`;
      cntElm_svg.insertAdjacentHTML('afterend', _html);
      // 绑定鼠标事件
      trElm.onmouseover = mouseOverHandler;
      trElm.onmouseout = mouseOutHandler;
    });
  }

  // 删除 Raw 快捷下载（☁）
  function delRawDownLink() {
    let aElm = document.querySelectorAll('.fileDownLink');
    if (aElm.length === 0) return;
    aElm.forEach(function(fileElm) {
      fileElm.remove();
    });
  }

  // 在浏览器返回/前进时重新添加 Raw 下载链接（☁）鼠标事件
  function addRawDownLink_() {
    // 如果不是项目文件页面，就返回，如果网页没有 Raw 下载链接（☁）就返回
    let files = document.querySelectorAll(
      'div.Box-row svg.octicon.octicon-file'
    );
    if (files.length === 0) return;
    let files1 = document.querySelectorAll('a.fileDownLink');
    if (files1.length === 0) return;

    // 鼠标指向则显示
    var mouseOverHandler = function(evt) {
      let elem = evt.currentTarget,
        aElm_new = elem.querySelectorAll('.fileDownLink'),
        aElm_now = elem.querySelectorAll('svg.octicon.octicon-file');
      aElm_new.forEach((el) => {
        el.style.cssText = 'display: inline';
      });
      aElm_now.forEach((el) => {
        el.style.cssText = 'display: none';
      });
    };

    // 鼠标离开则隐藏
    var mouseOutHandler = function(evt) {
      let elem = evt.currentTarget,
        aElm_new = elem.querySelectorAll('.fileDownLink'),
        aElm_now = elem.querySelectorAll('svg.octicon.octicon-file');
      aElm_new.forEach((el) => {
        el.style.cssText = 'display: none';
      });
      aElm_now.forEach((el) => {
        el.style.cssText = 'display: inline';
      });
    };

    // 循环添加
    files.forEach(function(fileElm, i) {
      let trElm = fileElm.parentNode.parentNode;
      // 绑定鼠标事件
      trElm.onmouseover = mouseOverHandler;
      trElm.onmouseout = mouseOutHandler;
    });
  }

  // 自定义 locationchange 事件（用来监听 URL 变化）
  function addLocationchange() {
    history.pushState = ((f) =>
      function pushState() {
        var ret = f.apply(this, arguments);
        window.dispatchEvent(new Event('pushstate'));
        window.dispatchEvent(new Event('locationchange'));
        return ret;
      })(history.pushState);

    history.replaceState = ((f) =>
      function replaceState() {
        var ret = f.apply(this, arguments);
        window.dispatchEvent(new Event('replacestate'));
        window.dispatchEvent(new Event('locationchange'));
        return ret;
      })(history.replaceState);

    window.addEventListener('popstate', () => {
      window.dispatchEvent(new Event('locationchange'));
    });
  }
})();
```

:::
