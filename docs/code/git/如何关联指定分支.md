---
title: 如何关联指定分支
date: "2021-06-02 22:26:04"
categories:
  - git
lang: zh-cn
---

## 背景

在开发大型项目的时候，会根据不同的迭代和开发人员，出现很多的分支，这些分支可能纵横交错，在可视化工具里面开上去就像一张巨大的网一样，也不具备了可识别性。而同时，随着时间的推移，有很多分支又是不再维护的，当然也不会又人敢真正的去删，所以，我需要一个方法能简洁的显示我所需要的分支

## 实现方法

### 1、关联仓库

第一步是关联仓库，这一步可以通过传统的`git clone`来关联，也可以手动创建文件夹之后添加远程仓库

第一种

```bash
git clone --depth=100 -b master [git repo url]
```

在 clone 的时候添加`--depth`和`-b`参数能够只 clone 指定的分支，例如 master

<!-- more -->

第二种

```bash
mkdir gitdemo && cd gitdemo

git remote add -t [branch] -f --no-tags origin [git repo url]

# 关联本地与远程分支
git branch --set-upstream-to=origin/[branch] [branch]
```

> `-f`参数表示 fetch，`--no-tags`表示不获取 tag

### 2、添加关联远程分支

```bash
git remote set-branches --add origin [需要关联的远程分支]
```

一般在一个新的迭代阶段，从主分支迁出一个开发分支之后，开发者自行关联。

### 3、删除远程分支关联

开发结束之后如果需要删除这个分支

```bash
git branch -d [branch]
```

删除 origin/[branch]，注意不是删除远程分支，而是删除本地的远程关联

找到`.git>refs>remotes`文件夹，删除分支名对应的文件即可

以上步骤完成以后，在下次更新远程分支（fetch/pull）的时候还是会把刚才的分支下载下来

所以还需要一步，打开`.git/config`文件，找到你要删除的分支名直接删除

### 例子 🌰

先假设一个分支`feature/env`

- 首先删除本地这个分支

```bash
$ git branch -d feature/env
```

对应的文件操作是，删除`.git/refs/heads/feature/env`

- 再删除再本地的远程分支

```bash
$ git branch -d -r origin/feature/env
```

对应的文件操作是，删除`.git/refs/remotes/origin/feature/env`

现在可以通过`git remote show origin`，查看远程分支的状态

```bash
$ git remote show origin
```

这个命令与`git branch -a`的区别在于，前者会联网检查远程分支，而后者之后检查本地分支所关联的远程分支

这个时候通过`remote show`就可以发现`feature/env`远程分支后面有句话`new (next fetch will store in remotes/origin)`

表示再下次执行`fetch`操作的时候会重新将该远程分支关联上

有两种方法可以删掉这个分支

> 不是真正的删掉远程上的这个分支

#### 删除关联

- 命令行方式

  ```bash
  $ git remote set-branches origin master // 只保留master
  $ git remote set-branches --add origin otherBranch // 添加其他分支
  ```

- 修改文件的方式

找到`.git/config`文件，文件最开始可能是这样的

```
[core]
	repositoryformatversion = 0
	filemode = false
	bare = false
	logallrefupdates = true
	symlinks = false
	ignorecase = true
[submodule]
	active = .
[remote "origin"]
	url = 【远程分支地址】
	fetch = +refs/heads/*:refs/remotes/origin/*
[branch "master"]
	remote = origin
	merge = refs/heads/master

```

需要修改的是 remote 那一项

```
[remote "origin"]
	url = 【远程分支地址】
	fetch = +refs/heads/master:refs/remotes/origin/master
	fetch = +refs/heads/otherBranch:refs/remotes/origin/otherBranch
```

这样就实现了只关联需要的分支
