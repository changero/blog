(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{484:function(t,s,a){"use strict";a.r(s);var n=a(14),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"引擎、运行时和调用堆栈的概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#引擎、运行时和调用堆栈的概述"}},[t._v("#")]),t._v(" 引擎、运行时和调用堆栈的概述")]),t._v(" "),s("p",[t._v("随着 JavaScript 变得越来越流行，团队正在利用其堆栈中许多级别的支持 - 前端，后端，混合应用程序，嵌入式设备等等。")]),t._v(" "),s("p",[t._v("这篇文章旨在深入挖掘 JavaScript 及其实际工作原理的系列文章中的第一篇：我们认为，通过了解 JavaScript 的构建块以及它们如何协同工作，将能够编写出更好的代码和应用程序")]),t._v(" "),s("p",[t._v("如果项目变得如此依赖 JavaScript，这意味着开发人员必须利用语言和生态系统提供的所有内容，对内部结构有越来越深的理解，以便构建令人惊叹的软件。")]),t._v(" "),s("h2",{attrs:{id:"概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),s("p",[t._v("几乎每个人都听说过 V8 引擎这个概念，大多数人都知道 JavaScript 是单线程的，或者它使用的是回调队列。在这篇文章中，我们将详细介绍所有这些概念，并解释 JavaScript 的实际运行方式。通过了解这些详细信息，您将能够编写出更好的，无阻塞的应用程序，这些应用程序可以正确利用提供的 API。")]),t._v(" "),s("h2",{attrs:{id:"js-引擎"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#js-引擎"}},[t._v("#")]),t._v(" js 引擎")]),t._v(" "),s("p",[t._v("JavaScript 引擎的一个流行例子是谷歌的 V8 引擎。V8 引擎再 Node 和 Chrome 中使用，下面是一个非常简化的视图")]),t._v(" "),s("c-img",{attrs:{src:"https://miro.medium.com/max/1400/1*OnH_DlbNAPvB9KLxUCyMsA.png"}}),t._v(" "),s("p",[t._v("引擎由两个主要组件组成：")]),t._v(" "),s("ol",[s("li",[t._v("堆内存：这是内存分配发生的地方")]),t._v(" "),s("li",[t._v("堆栈：这是代码执行时堆栈帧所在的位置")])]),t._v(" "),s("h3",{attrs:{id:"运行时"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行时"}},[t._v("#")]),t._v(" 运行时")]),t._v(" "),s("p",[t._v('浏览器中有一些 API 几乎被任何 JavaScript 开发人员使用过（例如"setTimeout"）。但是，这些 API 不是由引擎提供的。')]),t._v(" "),s("p",[t._v("那么，它们来自哪里呢？")]),t._v(" "),s("p",[t._v("事实证明，现实情况要复杂一些。")]),t._v(" "),s("c-img",{attrs:{src:"https://miro.medium.com/max/1400/1*4lHHyfEhVB0LnQ3HlhSs8g.png"}}),t._v(" "),s("p",[t._v("我们有那些叫做 Web API 的东西，它们是由"),s("strong",[t._v("浏览器")]),t._v("提供的，比如 DOM，AJAX，setTimeout 等等。")]),t._v(" "),s("p",[t._v("然后，我们有了接下来的"),s("strong",[t._v("事件循环")]),t._v("和"),s("strong",[t._v("回调队列")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"堆栈"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#堆栈"}},[t._v("#")]),t._v(" 堆栈")]),t._v(" "),s("p",[t._v("JavaScript 是一种单线程编程语言，这意味着它只有一个单一的调用堆栈。因此，它同一事件只做一件事。")]),t._v(" "),s("p",[s("em",[t._v("调用堆栈是一种数据结构，它基本上记录了我们在程序中的位置")]),t._v("。如果我们单步执行一个函数，我们将其放在堆栈的顶部。如果我们从函数返回，我们会弹出堆栈的顶部。这就是堆栈可以执行的所有操作。")]),t._v(" "),s("p",[t._v("看下面一个例子:")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("multiply")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" y")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printSquare")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("x")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" s "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("multiply")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printSquare")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[t._v("当引擎开始执行此代码时，调用堆栈是空的。之后，步骤如下：")]),t._v(" "),s("c-img",{attrs:{src:"https://miro.medium.com/max/1400/1*Yp1KOt_UJ47HChmS9y7KXw.png"}}),t._v(" "),s("p",[t._v("调用堆栈中的每个条目称为"),s("strong",[t._v("堆栈帧")]),t._v("。")]),t._v(" "),s("p",[t._v("这正是引发异常时堆栈跟踪的构造方式 - 它基本上是异常发生时调用堆栈的状态。请看下面的代码：")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Error")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SessionStack will help you resolve crashes :)'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bar")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("p",[t._v("如果在 Chrome 中执行此操作（假设此代码位于名为 foo.js 的文件中），则会生成以下堆栈跟踪：")]),t._v(" "),s("c-img",{attrs:{src:"https://miro.medium.com/max/1014/1*T-W_ihvl-9rG4dn18kP3Qw.png"}}),t._v(" "),s("p",[s("strong",[t._v("栈溢出")]),t._v("——当你的函数调用次数超过调用堆栈的大小时候就会发生，比如：递归调用")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v('当引擎开始执行此代码时，它首先调用函数"foo"。但是，此函数是递归的，并且在没有任何终止条件的情况下开始调用自身。因此，在执行的每一步中，相同的函数都会一遍又一遍地添加到调用堆栈中。它看起来像这样：')]),t._v(" "),s("c-img",{attrs:{src:"https://miro.medium.com/max/1400/1*AycFMDy9tlDmNoc5LXd9-g.png"}}),t._v(" "),s("p",[t._v("于是浏览器将显示如下的报错信息：")]),t._v(" "),s("c-img",{attrs:{src:"https://miro.medium.com/max/772/1*e0nEd59RPKz9coyY8FX-uw.png"}}),t._v(" "),s("p",[t._v("在单个线程上运行代码可能非常容易，因为您不必处理多线程环境中出现的复杂场景，例如死锁。")]),t._v(" "),s("h3",{attrs:{id:"并发和事件循环"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#并发和事件循环"}},[t._v("#")]),t._v(" 并发和事件循环")]),t._v(" "),s("p",[t._v("当您在调用堆栈中有需要大量时间才能处理的函数调用时，会发生什么情况？例如，假设您想在浏览器中使用 JavaScript 进行一些复杂的图像转换。")]),t._v(" "),s("p",[t._v("你可能会问 - 这样会有什么问题？问题在于，调用栈有要执行的功能，因此浏览器实际上无法执行任何其他操作 - 它被阻止了。浏览器线程与 js 的执行线程是互斥的。")]),t._v(" "),s("p",[t._v("这意味着浏览器无法渲染，无法运行任何其他代码。如果你想要在你的应用中使用漂亮的流畅 UI，这会产生问题。")]),t._v(" "),s("p",[t._v("这不是唯一的问题。一旦您的浏览器开始处理调用堆栈中的许多任务，它可能会在很长一段时间内停止响应。大多数浏览器通过引发错误来采取措施，询问您是否要终止网页。")]),t._v(" "),s("c-img",{attrs:{src:"https://miro.medium.com/max/924/1*WlMXK3rs_scqKTRV41au7g.jpeg"}}),t._v(" "),s("p",[t._v("那么，我们如何在不阻塞 UI 并使浏览器无响应的情况下执行繁重的代码呢？")]),t._v(" "),s("p",[t._v("解决方案是"),s("strong",[t._v("异步回调")]),t._v("。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://blog.sessionstack.com/how-does-javascript-actually-work-part-1-b0bacc073cf",target:"_blank",rel:"noopener noreferrer"}},[t._v("原文连接"),s("OutboundLink")],1)])],1)}),[],!1,null,null,null);s.default=r.exports}}]);