---
title: 操作符
date: '2021-12-05 17:51:06'
categories:
  - 数据库
tags:
  - mongodb
lang: zh-cn
---

## 操作符

### elemMatch

elemMatch 用于筛选返回数据中某数组里符合条件的项,是在 project 下面的筛选语句[参考](https://mongodb.net.cn/manual/reference/operator/projection/elemMatch/)

```js
// 在所有返回的数据里面都包含list字段,并且list中age小于12的数据都不会返回
col.find({}, { list: { $elemMatch: { age: 12 } } });
```

### in

`$in`操作符用于匹配指定字段的值中的一个，在`$in`指定的数组当中的数据

查找所有 211 学校

```js
col.find({ tags: { $in: ['211'] } });
```

查找所有 211 学校, 且不是 985 的学校

```js
col.find({ tags: { $in: ['211'], $nin: ['985'] } });
```

<!-- more -->

### all

查找同时满足给定数组所有值的数据

查找所有同时是 985、211 的学校

```js
col.find({ tags: { $all: ['211', '985'] } });
```

### size

匹配数组元素个数是指定值的数据

```js
col.find({ tags: { $size: 3 } });
// 返回tags元素个数是3的数据，只返回tags的第一个元素
col.find({ tags: { $size: 3 } }, { tags: { $slice: 1 } });
// 前2个元素
col.find({ tags: { $size: 3 } }, { tags: { $slice: 2 } });
// 最后一个元素
col.find({ tags: { $size: 3 } }, { tags: { $slice: -1 } });
```

### push

向数组中添加元素，不会判断之前是否已有该元素

```js
col.update({ name: '张三' }, { $push: { hobbys: 'smoking' } });
```

查找不存在该值的数据添加该值

```js
// 只匹配部分数据
col.update(
  { name: '张三', hobbys: { $ne: 'smoking' } },
  { $push: { hobbys: 'smoking' } }
);
```

### addToSet

向数组中添加元素，与 push 的不同之处在于会判断之前是否已有该元素

```js
// 匹配全部符合条件的数据数据
col.update({ name: '张三' }, { $addToSet: { hobbys: 'smoking' } });
```

添加多条数据

```js
const hobbys = ['playing', 'reading'];
col.update({ name: '张三' }, { $addToSet: { hobbys: { $each: hobbys } } });
```

### pop

删除数组中的一个

```js
col.update({ name: '张三' }, { $pop: { hobbys: 1 } });
```

### where

where 能在匹配文档的时候拿到当前匹配的文档对象

```js
col.find({ $where: 'this.age>30' });
```
