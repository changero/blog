(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{419:function(t,a,e){"use strict";e.r(a);var s=e(14),r=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"code-push"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#code-push"}},[t._v("#")]),t._v(" Code Push")]),t._v(" "),a("h2",{attrs:{id:"react-native-code-push"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#react-native-code-push"}},[t._v("#")]),t._v(" react-native-code-push")]),t._v(" "),a("p",[t._v("微软开发的中心化 codepush 服务，如今用 app center 替换，因为国内的访问速度的问题，一般都会用自建 code-push-server")]),t._v(" "),a("h2",{attrs:{id:"code-push-cli"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#code-push-cli"}},[t._v("#")]),t._v(" code-push-cli")]),t._v(" "),a("p",[t._v("本地通过命令操作 codepush，相当于客户端，默认连接的是微软官方的服务")]),t._v(" "),a("p",[t._v("连接自己的服务器，需要修改"),a("code",[t._v("react-native-code-push")]),t._v("包中"),a("code",[t._v("package.json")]),t._v("和"),a("code",[t._v("react-native.config.js")]),t._v("文件中"),a("code",[t._v("new CodePush")]),t._v("的内容，在"),a("code",[t._v("BuildConfig.DEBUG")]),t._v("后面添加一个参数，就是服务器地址")]),t._v(" "),a("h3",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("p",[t._v("指定 2.1.9 版本，否则不能用自定义的 server 服务")]),t._v(" "),a("blockquote",[a("p",[t._v("npm i code-push-cli@2.1.9 -g")])]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注册")]),t._v("\ncode-push register\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h2",{attrs:{id:"code-push-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#code-push-server"}},[t._v("#")]),t._v(" "),a("a",{attrs:{href:"https://github.com/lisong/code-push-server",target:"_blank",rel:"noopener noreferrer"}},[t._v("code-push-server"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("可用于自行搭建的 codepush 服务，"),a("a",{attrs:{href:"https://www.jianshu.com/p/ca4beb5973bb",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作"}},[t._v("#")]),t._v(" 操作")]),t._v(" "),a("h3",{attrs:{id:"登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录"}},[t._v("#")]),t._v(" 登录")]),t._v(" "),a("blockquote",[a("p",[t._v("code-push login https://ip:port")])]),t._v(" "),a("h3",{attrs:{id:"注册"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注册"}},[t._v("#")]),t._v(" 注册")]),t._v(" "),a("blockquote",[a("p",[t._v("code-push register https://ip:port")])]),t._v(" "),a("h3",{attrs:{id:"app-相关命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#app-相关命令"}},[t._v("#")]),t._v(" APP 相关命令")]),t._v(" "),a("blockquote",[a("p",[t._v("code-push app --help")])]),t._v(" "),a("h4",{attrs:{id:"添加-app"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加-app"}},[t._v("#")]),t._v(" 添加 APP")]),t._v(" "),a("blockquote",[a("p",[t._v("code-push app add --help")])]),t._v(" "),a("p",[t._v("e.g")]),t._v(" "),a("blockquote",[a("p",[t._v("code-push app add rndemo-ios ios react-native")]),t._v(" "),a("p",[t._v("code-push app add rndemo-android android react-native")])]),t._v(" "),a("p",[t._v("就可以获取"),a("code",[t._v("DevelopmentKey")]),t._v("了，之后就可以在"),a("code",[t._v("info.plist")]),t._v("中修改")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("String")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("CodePushDeploymentKey")]),t._v(" "),a("td",[t._v("DeploymentKey")])]),t._v(" "),a("tr",[a("td",[t._v("CodePushServerURL")]),t._v(" "),a("td",[t._v("http://ip:port")])])])]),t._v(" "),a("h3",{attrs:{id:"推热更"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#推热更"}},[t._v("#")]),t._v(" 推热更")]),t._v(" "),a("blockquote",[a("p",[t._v("code-push release-react --help")])]),t._v(" "),a("p",[t._v("e.g")]),t._v(" "),a("blockquote",[a("p",[t._v('code-push release-react rndemo-android android --t 3.4.2 --dev false --d Staging --des "youhui" --m true')])]),t._v(" "),a("blockquote",[a("p",[t._v('code-push release-react rndemo-ios android --t 3.3.0 --dev false --d Production --des "更新了一部分内容" --m true')])]),t._v(" "),a("h3",{attrs:{id:"添加部署环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加部署环境"}},[t._v("#")]),t._v(" 添加部署环境")]),t._v(" "),a("blockquote",[a("p",[t._v("code-push deployment add <app_name> test")])]),t._v(" "),a("h3",{attrs:{id:"查看-app-的环境信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看-app-的环境信息"}},[t._v("#")]),t._v(" 查看 APP 的环境信息")]),t._v(" "),a("blockquote",[a("p",[t._v("code-push deployment list <app_name> --format json")])]),t._v(" "),a("h3",{attrs:{id:"查看应用列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看应用列表"}},[t._v("#")]),t._v(" 查看应用列表")]),t._v(" "),a("blockquote",[a("p",[t._v("code-push app list")])]),t._v(" "),a("h3",{attrs:{id:"查看-bundle-包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看-bundle-包"}},[t._v("#")]),t._v(" 查看 Bundle 包")]),t._v(" "),a("blockquote",[a("p",[t._v("code-push deployment history rndemo-android Staging")])]),t._v(" "),a("blockquote",[a("p",[t._v("code-push deployment history rndemo-android Production")])]),t._v(" "),a("h3",{attrs:{id:"回滚"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回滚"}},[t._v("#")]),t._v(" 回滚")]),t._v(" "),a("blockquote",[a("p",[t._v('code-push rollback MyApp Production // "MyApp"中"Production"部署执行回滚')])]),t._v(" "),a("blockquote",[a("p",[t._v('code-push rollback MyApp Production --targetRelease v4 // "MyApp"中"Production"部署执行回滚，回滚到 v4 这个标签版本')])]),t._v(" "),a("h3",{attrs:{id:"react-native-打包命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#react-native-打包命令"}},[t._v("#")]),t._v(" react-native 打包命令")]),t._v(" "),a("blockquote",[a("p",[t._v("react-native bundle --entry-file index.js --bundle-output ./android/[path]/.jsbundle --platform android --dev false")]),t._v(" "),a("p",[t._v("react-native bundle --entry-file index.js --bundle-output ./ios/[path]/.jsbundle --platform ios--dev false")])]),t._v(" "),a("blockquote",[a("p",[t._v("--reset-cache 禁用 metro 缓存，因为未变化的文件会直接使用缓存的结果，加快构建速度。查看"),a("a",{attrs:{href:"https://www.jianshu.com/p/52620bc4b728",target:"_blank",rel:"noopener noreferrer"}},[t._v("链接"),a("OutboundLink")],1)])]),t._v(" "),a("h3",{attrs:{id:"查看生成的-app-key"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看生成的-app-key"}},[t._v("#")]),t._v(" 查看生成的 APP key")]),t._v(" "),a("blockquote",[a("p",[t._v("code-push deployment ls [app-name] -k")])]),t._v(" "),a("h3",{attrs:{id:"rn-中集成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rn-中集成"}},[t._v("#")]),t._v(" rn 中集成")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" CodePush "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"react-native-code-push"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("APP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("CodePush")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("APP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("CodePush")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置检查更新的频率")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//ON_APP_RESUME APP恢复到前台的时候")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//ON_APP_START APP开启的时候")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//MANUAL 手动检查")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("checkFrequency")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" CodePush"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CheckFrequency"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ON_APP_RESUME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("APP")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("h3",{attrs:{id:"安卓集成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安卓集成"}},[t._v("#")]),t._v(" 安卓集成")]),t._v(" "),a("h3",{attrs:{id:"ios-集成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ios-集成"}},[t._v("#")]),t._v(" ios 集成")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/cd7576af381f",target:"_blank",rel:"noopener noreferrer"}},[t._v("Code-Push 使用 - 简书 (jianshu.com)"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=r.exports}}]);