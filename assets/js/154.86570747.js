(window.webpackJsonp=window.webpackJsonp||[]).push([[154],{501:function(t,s,a){"use strict";a.r(s);var e=a(14),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),s("p",[t._v("作为 7 年老前端，终于写出了我的第一个 nodejs 工具"),s("a",{attrs:{href:"https://github.com/changero/nusage",target:"_blank",rel:"noopener noreferrer"}},[t._v("nusage"),s("OutboundLink")],1),t._v("。抛开能力不谈，主要这几年对自己的时间规划不够、以及缺乏了主动积极性导致的。不敢说以后就一定怎么怎么样，只希望自己在未来能更认真的做事，杜绝没有价值的事情占用太多的时间")]),t._v(" "),s("p",[t._v("项目起源自看到的"),s("a",{attrs:{href:"https://github.com/chenquan/diskusage",target:"_blank",rel:"noopener noreferrer"}},[t._v("这个"),s("OutboundLink")],1),t._v("使用"),s("code",[t._v("go lang")]),t._v("实现的查看文件大小的工具，突然萌发了自己使用 nodejs 来实现相同功能的工具的想法")]),t._v(" "),s("p",[t._v("从昨天到现在不到 24 小时的时间里，终于是完成了项目的基本结构和发布流程。主要包括")]),t._v(" "),s("ol",[s("li",[t._v("使用 rollup+babel 进行打包")]),t._v(" "),s("li",[t._v("通过 npm 全局安装的方式来使用可执行命令")]),t._v(" "),s("li",[t._v("配合 github actions 完成 publish 和 release 的动作")])]),t._v(" "),s("h1",{attrs:{id:"项目说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目说明"}},[t._v("#")]),t._v(" 项目说明")]),t._v(" "),s("p",[t._v("目前项目设施还很简陋，只有 rollup 和 babel，主要还是功能比较简单，并且今天主要的工作还是把整个链路走通，所有没有弄其他花哨的东西进来。")]),t._v(" "),s("p",[t._v("项目通过 rollup 将"),s("code",[t._v("src")]),t._v("中的源文件打包成 cjs 模块放到"),s("code",[t._v("dist")]),t._v("目录下。node 平台下，打包工具还有其他的，比如："),s("code",[t._v("webpack")]),t._v("、"),s("code",[t._v("browserify")]),t._v("等。这里选择 rollup 也是想练练手，学习一下的意思。")]),t._v(" "),s("p",[t._v("值得注意的几个点：")]),t._v(" "),s("ol",[s("li",[t._v("项目名是一个 scope 名，因此发布的时候一定要指定"),s("code",[t._v("access: public")]),t._v("。最好的方法是在"),s("code",[t._v("package.json")]),t._v("中配置"),s("code",[t._v("publishConfig")]),t._v("属性")]),t._v(" "),s("li",[t._v("因为包要向外提供可执行文件，因此需要在"),s("code",[t._v("package.json")]),t._v("中配置"),s("code",[t._v("bin")]),t._v("字段。该字段可以是一个字符串，表示用哪个文件作为可执行文件。也可以是一个对象，其中每一个字段就是向外提供的一个工具名，字段的值就是可执行文件的路径")])]),t._v(" "),s("h2",{attrs:{id:"关于可执行文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关于可执行文件"}},[t._v("#")]),t._v(" 关于可执行文件")]),t._v(" "),s("p",[t._v("除了提供命令行的方式使用，还提供了可执行文件，包括 Windows/MAC/Linux。这里主要是使用"),s("RouterLink",{attrs:{to:"/code/node/nexe介绍.html#前言"}},[t._v("nexe")]),t._v("来完成可执行文件的编译工作")],1),t._v(" "),s("p",[t._v("nexe 使用起来唯一比较难的就是编译包需要从 github 下载到本地的"),s("code",[t._v("~/.nexe")]),t._v("目录中，才能完成编译的动作。不过好在这个在 Github actions 上都不是问题")]),t._v(" "),s("h1",{attrs:{id:"自动化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自动化"}},[t._v("#")]),t._v(" 自动化")]),t._v(" "),s("p",[t._v("基于上述的 2 个主要发包动作，采用 Github actions 来完成，没办法，就是方便。")]),t._v(" "),s("p",[t._v("省去一些不重要的中间流程，这里主要说几个主要的点")]),t._v(" "),s("h2",{attrs:{id:"获取-tag"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获取-tag"}},[t._v("#")]),t._v(" 获取 tag")]),t._v(" "),s("p",[t._v("由于发布的时候需要对资源进行标记，也就是打 tag，最方便的就是获取 git 里面的 tag，在推代码之前，通过"),s("code",[t._v("standard-version")]),t._v("这个包来完成")]),t._v(" "),s("p",[t._v("在 actions 中方法如下：")]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Get Version\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" get_version\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" echo "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("set"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("output name=VERSION"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("GITHUB_REF/refs\\/tags\\//"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[t._v("这样在后续的流程中，就可以通过"),s("code",[t._v("steps.get_version.outputs.VERSION")]),t._v("变量来访问")]),t._v(" "),s("h2",{attrs:{id:"发布到仓库的-release"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布到仓库的-release"}},[t._v("#")]),t._v(" 发布到仓库的 release")]),t._v(" "),s("p",[t._v("将打包出来的可执行文件都放在 release 文件夹中")]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ncipollo/release"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@v1.10.0\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("artifacts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"release/*"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("token")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.MY_GITHUB_TOKEN "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("h2",{attrs:{id:"发布到-npm-registry"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布到-npm-registry"}},[t._v("#")]),t._v(" 发布到 npm registry")]),t._v(" "),s("div",{staticClass:"language-yml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" JS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("DevTools/npm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("publish@v1\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("token")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.NPM_TOKEN "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("access")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" public\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tag")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" steps.get_version.outputs.VERSION "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[t._v("其中 tag 可以不传，默认就是 latest")]),t._v(" "),s("h1",{attrs:{id:"后续规划"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#后续规划"}},[t._v("#")]),t._v(" 后续规划")]),t._v(" "),s("p",[t._v("今天实现的主要的构建和发布流程，后续就主要规划对项目功能本身进行迭代。目前可以列出来的点：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("loading 展示，计划使用"),s("a",{attrs:{href:"https://github.com/sindresorhus/ora",target:"_blank",rel:"noopener noreferrer"}},[t._v("ora"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[t._v("ui 重构，使用 React 语法的"),s("a",{attrs:{href:"https://github.com/vadimdemedes/ink",target:"_blank",rel:"noopener noreferrer"}},[t._v("ink"),s("OutboundLink")],1),t._v("，或者 Vue 语法的"),s("a",{attrs:{href:"https://github.com/webfansplz/temir",target:"_blank",rel:"noopener noreferrer"}},[t._v("temir"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[t._v("添加命令行参数，如层级、忽略文件夹、指定目录、指定文件类型")])]),t._v(" "),s("li",[s("p",[t._v("多线程计算")])]),t._v(" "),s("li",[s("p",[t._v("封装 gui")])])]),t._v(" "),s("p",[t._v("想法需要有，慢慢做，万一都完成了呢")])])}),[],!1,null,null,null);s.default=n.exports}}]);