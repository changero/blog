(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{396:function(e,s,r){"use strict";r.r(s);var t=r(14),n=Object(t.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("p",[e._v("事情是这样的，nas机器上有几个服务版本太老，想要通过docker升级一下，但是在执行"),s("code",[e._v("docker pull")]),e._v("的时候永远都会返回一个错误")]),e._v(" "),s("blockquote",[s("p",[e._v('Error response from daemon: Get "https://registry-1.docker.io/v2/": net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)')])]),e._v(" "),s("p",[e._v("看到这个提示的，第一时间能想到的就是在pull的时候，直接走了官方的镜像源去下载，由于网络的问题导致了下载失败。")]),e._v(" "),s("p",[e._v("所以自然就想到了用"),s("a",{attrs:{href:"./docker%E5%AE%89%E8%A3%85%E5%8F%8A%E5%8A%A0%E9%80%9F%E5%99%A8%E5%92%8C%E9%95%9C%E5%83%8F"}},[s("code",[e._v("registry-mirrors")])]),e._v(" 来解决这个问题。中间还经历过对docker的卸载和重装，版本是升级为了23版本")]),e._v(" "),s("p",[e._v("结果无论怎么修改"),s("code",[e._v("registry-mirrors")]),e._v("，哪怕是只留下自己在阿里云容器服务里的专有地址，都仍然出现上面的错误")]),e._v(" "),s("p",[e._v("期间除了修改"),s("code",[e._v("registry")]),e._v("，还包括修改本机DNS等都无济于事")]),e._v(" "),s("p",[e._v("鬼使神差之下，想着能不同通过登录阿里云的容器服务，来下载包，于是指定"),s("code",[e._v("docker login --username=email registry-cn.hangzhou.aliyuncs.com")]),e._v("为阿里云容器服务公网地址。这时候仍然出现了上述的错误，但是提示的地址变为了阿里云的地址，也就是说这个时候，确确实实走的是阿里云的地址去登录，但为什么还是无法登录呢？")]),e._v(" "),s("p",[e._v("我直接ping了一下阿里云的地址，发现是能ping通的，也就是说本机网络，和地址都没有问题，问题就只可能出现docker上")]),e._v(" "),s("p",[e._v("由于对docker不是很熟悉，所以就想到能不能通过代理让docker去执行pull的动作，最后发现是可行的，具体设置方法可以查看"),s("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1806455",target:"_blank",rel:"noopener noreferrer"}},[e._v("文章"),s("OutboundLink")],1),e._v("，摘抄至如下：")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" -p /etc/systemd/system/docker.service.d\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("touch")]),e._v(" /etc/systemd/system/docker.service.d/proxy.conf\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("修改这个conf文件")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('[Service]\nEnvironment="HTTP_PROXY=http://proxy.example.com:8080/"\nEnvironment="HTTPS_PROXY=http://proxy.example.com:8080/"\nEnvironment="NO_PROXY=localhost,127.0.0.1,.example.com"\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("p",[e._v("然后重启")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("systemctl daemon-reload\nsystemctl restart "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("docker")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("接着再次执行pull的时候，就可以了。")]),e._v(" "),s("p",[e._v("并且，发现这个时候在代理软件中看到了，在"),s("code",[e._v("registry-mirrors")]),e._v("设置的阿里云专属加速地址也可以用了，反正就是贼神奇")]),e._v(" "),s("p",[e._v("对了，docker升级以后，对非登录用户做了限制，所以pull之前是必须要登录的")]),e._v(" "),s("blockquote",[s("ul",[s("li",[s("p",[e._v("根据Docker公司政策，2020年11月01日起将逐步向Docker Hub匿名和免费用户实施速率和拉取请求次数限制。ACR镜像加速器无法保障一定拉取到latest最新的镜像版本，建议您指定镜像版本拉取。")]),e._v(" "),s("p",[e._v("关于Docker Hub拉取请求次数限制的详细介绍，请参见"),s("a",{attrs:{href:"https://docs.docker.com/docker-hub/download-rate-limit/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Download rate limit"),s("OutboundLink")],1),e._v("。")])])])])])}),[],!1,null,null,null);s.default=n.exports}}]);